/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=r>>2,l=(3&r)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),i.push(n[u],n[l],n[h],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(d,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new l(i,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],s=e[r];if(p(n)&&p(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const i=e*Math.pow(n,t),r=Math.round(v*i*(Math.random()-.5)*2);return Math.min(y,i+r)}function b(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class _{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&t(s,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===T?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class I{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new _(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const S=[];var C;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(C||(C={}));const A={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},D=C.INFO,k={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},N=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=k[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class x{constructor(t){this.name=t,this._logLevel=D,this._logHandler=N,this._userLogHandler=null,S.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in C))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?A[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...t),this._logHandler(this,C.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...t),this._logHandler(this,C.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,C.INFO,...t),this._logHandler(this,C.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,C.WARN,...t),this._logHandler(this,C.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...t),this._logHandler(this,C.ERROR,...t)}}const R=(t,e)=>e.some((e=>t instanceof e));let L,M;const O=new WeakMap,P=new WeakMap,F=new WeakMap,V=new WeakMap,q=new WeakMap;let U={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return P.get(t);if("objectStoreNames"===e)return t.objectStoreNames||F.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function B(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(j(this),t),z(O.get(this))}:function(...t){return z(e.apply(j(this),t))}:function(t,...n){const i=e.call(j(this),t,...n);return F.set(i,t.sort?t.sort():[t]),z(i)}:(t instanceof IDBTransaction&&function(t){if(P.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));P.set(t,e)}(t),R(t,L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,U):t);var e}function z(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(z(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&O.set(e,t)})).catch((()=>{})),q.set(e,t),e}(t);if(V.has(t))return V.get(t);const e=B(t);return e!==t&&(V.set(t,e),q.set(e,t)),e}const j=t=>q.get(t);function $(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=z(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(z(o.result),t.oldVersion,t.newVersion,z(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const K=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],G=new Map;function Q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(G.get(e))return G.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=H.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!K.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return G.set(e,s),s}var W;W=U,U={...W,get:(t,e,n)=>Q(t,e)||W.get(t,e,n),has:(t,e)=>!!Q(t,e)||W.has(t,e)};class X{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Y="@firebase/app",J="0.10.2",Z=new x("@firebase/app"),tt="@firebase/app-compat",et="@firebase/analytics-compat",nt="@firebase/analytics",it="@firebase/app-check-compat",rt="@firebase/app-check",st="@firebase/auth",ot="@firebase/auth-compat",at="@firebase/database",ct="@firebase/database-compat",ut="@firebase/functions",lt="@firebase/functions-compat",ht="@firebase/installations",dt="@firebase/installations-compat",ft="@firebase/messaging",pt="@firebase/messaging-compat",gt="@firebase/performance",mt="@firebase/performance-compat",yt="@firebase/remote-config",vt="@firebase/remote-config-compat",wt="@firebase/storage",bt="@firebase/storage-compat",Et="@firebase/firestore",Tt="@firebase/firestore-compat",_t="firebase",It="[DEFAULT]",St={[Y]:"fire-core",[tt]:"fire-core-compat",[nt]:"fire-analytics",[et]:"fire-analytics-compat",[rt]:"fire-app-check",[it]:"fire-app-check-compat",[st]:"fire-auth",[ot]:"fire-auth-compat",[at]:"fire-rtdb",[ct]:"fire-rtdb-compat",[ut]:"fire-fn",[lt]:"fire-fn-compat",[ht]:"fire-iid",[dt]:"fire-iid-compat",[ft]:"fire-fcm",[pt]:"fire-fcm-compat",[gt]:"fire-perf",[mt]:"fire-perf-compat",[yt]:"fire-rc",[vt]:"fire-rc-compat",[wt]:"fire-gcs",[bt]:"fire-gcs-compat",[Et]:"fire-fst",[Tt]:"fire-fst-compat","fire-js":"fire-js",[_t]:"fire-js-all"},Ct=new Map,At=new Map,Dt=new Map;function kt(t,e){try{t.container.addComponent(e)}catch(n){Z.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Nt(t){const e=t.name;if(Dt.has(e))return Z.debug(`There were multiple attempts to register component ${e}.`),!1;Dt.set(e,t);for(const e of Ct.values())kt(e,t);for(const e of At.values())kt(e,t);return!0}function xt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Rt=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Lt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Rt.create("app-deleted",{appName:this._name})}}function Mt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:It,automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw Rt.create("bad-app-name",{appName:String(r)});if(n||(n=o()),!n)throw Rt.create("no-options");const s=Ct.get(r);if(s){if(f(n,s.options)&&f(i,s.config))return s;throw Rt.create("duplicate-app",{appName:r})}const a=new I(r);for(const t of Dt.values())a.addComponent(t);const c=new Lt(n,i,a);return Ct.set(r,c),c}function Ot(t=It){const e=Ct.get(t);if(!e&&t===It&&o())return Mt();if(!e)throw Rt.create("no-app",{appName:t});return e}function Pt(t,e,n){var i;let r=null!==(i=St[t])&&void 0!==i?i:t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${r}" with version "${e}":`];return s&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Z.warn(t.join(" "))}Nt(new E(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const Ft="firebase-heartbeat-database",Vt=1,qt="firebase-heartbeat-store";let Ut=null;function Bt(){return Ut||(Ut=$(Ft,Vt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(qt)}catch(t){console.warn(t)}}}).catch((t=>{throw Rt.create("idb-open",{originalErrorMessage:t.message})}))),Ut}async function zt(t,e){try{const n=(await Bt()).transaction(qt,"readwrite"),i=n.objectStore(qt);await i.put(e,jt(t)),await n.done}catch(t){if(t instanceof l)Z.warn(t.message);else{const e=Rt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}function jt(t){return`${t.name}!${t.options.appId}`}class $t{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ht(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Kt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==i&&!this._heartbeatsCache.heartbeats.some((t=>t.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Kt(),{heartbeatsToSend:n,unsentEntries:i}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),Gt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Gt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=r(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Kt(){return(new Date).toISOString().substring(0,10)}class Ht{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Bt()).transaction(qt),n=await e.objectStore(qt).get(jt(t));return await e.done,n}catch(t){if(t instanceof l)Z.warn(t.message);else{const e=Rt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return zt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return zt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Gt(t){return r(JSON.stringify({version:2,heartbeats:t})).length}Nt(new E("platform-logger",(t=>new X(t)),"PRIVATE")),Nt(new E("heartbeat",(t=>new $t(t)),"PRIVATE")),Pt(Y,J,""),Pt(Y,J,"esm2017"),Pt("fire-js",""),Pt("firebase","10.11.1","app");const Qt="@firebase/installations",Wt="0.6.6",Xt=1e4,Yt=`w:${Wt}`,Jt="FIS_v2",Zt="https://firebaseinstallations.googleapis.com/v1",te=36e5,ee=new h("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ne(t){return t instanceof l&&t.code.includes("request-failed")}function ie({projectId:t}){return`${Zt}/projects/${t}/installations`}function re(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function se(t,e){const n=(await e.json()).error;return ee.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function oe({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function ae(t){const e=await t();return e.status>=500&&e.status<600?t():e}function ce(t){return new Promise((e=>{setTimeout(e,t)}))}const ue=/^[cdef][\w-]{21}$/,le="";function he(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return ue.test(e)?e:le}catch(t){return le}}function de(t){return`${t.appName}!${t.appId}`}const fe=new Map;function pe(t,e){const n=de(t);ge(n,e),function(t,e){const n=(!me&&"BroadcastChannel"in self&&(me=new BroadcastChannel("[Firebase] FID Change"),me.onmessage=t=>{ge(t.data.key,t.data.fid)}),me);n&&n.postMessage({key:t,fid:e}),0===fe.size&&me&&(me.close(),me=null)}(n,e)}function ge(t,e){const n=fe.get(t);if(n)for(const t of n)t(e)}let me=null;const ye="firebase-installations-database",ve=1,we="firebase-installations-store";let be=null;function Ee(){return be||(be=$(ye,ve,{upgrade:(t,e)=>{0===e&&t.createObjectStore(we)}})),be}async function Te(t,e){const n=de(t),i=(await Ee()).transaction(we,"readwrite"),r=i.objectStore(we),s=await r.get(n);return await r.put(e,n),await i.done,s&&s.fid===e.fid||pe(t,e.fid),e}async function _e(t){const e=de(t),n=(await Ee()).transaction(we,"readwrite");await n.objectStore(we).delete(e),await n.done}async function Ie(t,e){const n=de(t),i=(await Ee()).transaction(we,"readwrite"),r=i.objectStore(we),s=await r.get(n),o=e(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||pe(t,o.fid),o}async function Se(t){let e;const n=await Ie(t.appConfig,(n=>{const i=function(t){return De(t||{fid:he(),registrationStatus:0})}(n),r=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(ee.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=ie(t),r=oe(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={fid:n,authVersion:Jt,appId:t.appId,sdkVersion:Yt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await ae((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:re(t.authToken)}}throw await se("Create Installation",c)}(t,e);return Te(t.appConfig,n)}catch(n){throw ne(n)&&409===n.customData.serverCode?await _e(t.appConfig):await Te(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Ce(t)}:{installationEntry:e}}(t,i);return e=r.registrationPromise,r.installationEntry}));return n.fid===le?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Ce(t){let e=await Ae(t.appConfig);for(;1===e.registrationStatus;)await ce(100),e=await Ae(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Se(t);return n||e}return e}function Ae(t){return Ie(t,(t=>{if(!t)throw ee.create("installation-not-found");return De(t)}))}function De(t){return 1===(e=t).registrationStatus&&e.registrationTime+Xt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function ke({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${ie(t)}/${e}/authTokens:generate`}(t,n),r=function(t,{refreshToken:e}){const n=oe(t);return n.append("Authorization",function(t){return`${Jt} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={installation:{sdkVersion:Yt,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await ae((()=>fetch(i,a)));if(c.ok)return re(await c.json());throw await se("Generate Auth Token",c)}async function Ne(t,e=!1){let n;const i=await Ie(t.appConfig,(i=>{if(!Re(i))throw ee.create("not-registered");const r=i.authToken;if(!e&&(2===(s=r).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+te}(s)))return i;var s;if(1===r.requestStatus)return n=async function(t,e){let n=await xe(t.appConfig);for(;1===n.authToken.requestStatus;)await ce(100),n=await xe(t.appConfig);const i=n.authToken;return 0===i.requestStatus?Ne(t,e):i}(t,e),i;{if(!navigator.onLine)throw ee.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await ke(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Te(t.appConfig,i),n}catch(n){if(!ne(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Te(t.appConfig,n)}else await _e(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function xe(t){return Ie(t,(t=>{if(!Re(t))throw ee.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+Xt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Re(t){return void 0!==t&&2===t.registrationStatus}function Le(t){return ee.create("missing-app-config-values",{valueName:t})}const Me="installations";Nt(new E(Me,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Le("App Configuration");if(!t.name)throw Le("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Le(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:xt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Nt(new E("installations-internal",(t=>{const e=xt(t.getProvider("app").getImmediate(),Me).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await Se(e);return i?i.catch(console.error):Ne(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Se(t);e&&await e}(n),(await Ne(n,e)).token}(e,t)}}),"PRIVATE")),Pt(Qt,Wt),Pt(Qt,Wt,"esm2017");const Oe="analytics",Pe="firebase_id",Fe="origin",Ve=6e4,qe="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ue="https://www.googletagmanager.com/gtag/js",Be=new x("@firebase/analytics"),ze=new h("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function je(t){if(!t.startsWith(Ue)){const e=ze.create("invalid-gtag-resource",{gtagURL:t});return Be.warn(e.message),""}return t}function $e(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Ke=30,He=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Ge(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Qe(t,e=He,n){const{appId:i,apiKey:r,measurementId:s}=t.options;if(!i)throw ze.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw ze.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Xe;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Ve),We({appId:i,apiKey:r,measurementId:s},o,a,e)}async function We(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=He){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(n,r);t.addEventListener((()=>{clearTimeout(s),i(ze.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return Be.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:Ge(i)},s=qe.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw ze.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof l&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(r.deleteThrottleMetadata(o),a)return Be.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?w(n,r.intervalMillis,Ke):w(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return r.setThrottleMetadata(o,h),Be.debug(`Calling attemptFetch again in ${u} millis`),We(t,h,i,r)}}class Xe{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ye,Je;async function Ze(t,e,n,i,r,s,o){var a;const l=Qe(t);l.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Be.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Be.error(t))),e.push(l);const h=async function(){if(!c())return Be.warn(ze.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return Be.warn(ze.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([l,h]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Ue)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:je}),i=document.createElement("script"),r=`${Ue}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,d.measurementId),Je&&(r("consent","default",Je),Je=void 0),r("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[Fe]="firebase",p.update=!0,null!=f&&(p[Pe]=f),r("config",d.measurementId,p),Ye&&(r("set",Ye),Ye=void 0),d.measurementId}class tn{constructor(t){this.app=t}_delete(){return delete en[this.app.options.appId],Promise.resolve()}}let en={},nn=[];const rn={};let sn,on,an="dataLayer",cn=!1;function un(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=ze.create("invalid-analytics-context",{errorInfo:e});Be.warn(n.message)}}();const i=t.options.appId;if(!i)throw ze.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw ze.create("no-api-key");Be.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=en[i])throw ze.create("already-exists",{id:i});if(!cn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(an);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,r){let s=function(...t){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(t,e,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(t,e,n,i,r){try{let s=[];if(r&&r.send_to){let t=r.send_to;Array.isArray(t)||(t=[t]);const i=await $e(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),r=t&&e[t.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",i,r||{})}catch(t){Be.error(t)}}(t,e,n,i,r)}else if("config"===r){const[r,o]=s;await async function(t,e,n,i,r,s){const o=i[r];try{if(o)await e[o];else{const t=(await $e(n)).find((t=>t.measurementId===r));t&&await e[t.appId]}}catch(t){Be.error(t)}t("config",r,s)}(t,e,n,i,r,o)}else if("consent"===r){const[e]=s;t("consent","update",e)}else if("get"===r){const[e,n,i]=s;t("get",e,n,i)}else if("set"===r){const[e]=s;t("set",e)}else t(r,...s)}catch(t){Be.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[r]}}(en,nn,rn,an,"gtag");on=t,sn=e,cn=!0}return en[i]=Ze(t,nn,rn,e,sn,an,n),new tn(t)}const ln="@firebase/analytics",hn="0.10.2";Nt(new E(Oe,((t,{options:e})=>un(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),Nt(new E("analytics-internal",(function(t){try{const e=t.getProvider(Oe).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=b(t),async function(t,e,n,i,r){if(r&&r.global)t("event",n,i);else{const r=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(on,en[t.app.options.appId],e,n,i).catch((t=>Be.error(t)))}(e,t,n,i)}}catch(t){throw ze.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Pt(ln,hn),Pt(ln,hn,"esm2017");var dn,fn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pn={},gn=gn||{},mn=fn||self;function yn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function vn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var wn="closure_uid_"+(1e9*Math.random()>>>0),bn=0;function En(t,e,n){return t.call.apply(t.bind,arguments)}function Tn(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _n(t,e,n){return(_n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?En:Tn).apply(null,arguments)}function In(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Sn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[n].apply(t,r)}}function Cn(){this.s=this.s,this.o=this.o}Cn.prototype.s=!1,Cn.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,wn)&&t[wn]||(t[wn]=++bn))},Cn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const An=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Dn(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function kn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(yn(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let r=0;r<i;r++)t[e+r]=n[r]}else t.push(n)}}function Nn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Nn.prototype.h=function(){this.defaultPrevented=!0};var xn=function(){if(!mn.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};mn.addEventListener("test",t,e),mn.removeEventListener("test",t,e)}catch(t){}return t}();function Rn(t){return/^[\s\xa0]*$/.test(t)}function Ln(){var t=mn.navigator;return t&&(t=t.userAgent)?t:""}function Mn(t){return-1!=Ln().indexOf(t)}function On(t){return On[" "](t),t}On[" "]=function(){};var Pn,Fn,Vn,qn=Mn("Opera"),Un=Mn("Trident")||Mn("MSIE"),Bn=Mn("Edge"),zn=Bn||Un,jn=Mn("Gecko")&&!(-1!=Ln().toLowerCase().indexOf("webkit")&&!Mn("Edge"))&&!(Mn("Trident")||Mn("MSIE"))&&!Mn("Edge"),$n=-1!=Ln().toLowerCase().indexOf("webkit")&&!Mn("Edge");function Kn(){var t=mn.document;return t?t.documentMode:void 0}t:{var Hn="",Gn=(Fn=Ln(),jn?/rv:([^\);]+)(\)|;)/.exec(Fn):Bn?/Edge\/([\d\.]+)/.exec(Fn):Un?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Fn):$n?/WebKit\/(\S+)/.exec(Fn):qn?/(?:Version)[ \/]?(\S+)/.exec(Fn):void 0);if(Gn&&(Hn=Gn?Gn[1]:""),Un){var Qn=Kn();if(null!=Qn&&Qn>parseFloat(Hn)){Pn=String(Qn);break t}}Pn=Hn}mn.document&&Un?Vn=Kn()||parseInt(Pn,10)||void 0:Vn=void 0;var Wn=Vn;function Xn(t,e){if(Nn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(jn){t:{try{On(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Yn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Xn.$.h.call(this)}}Sn(Xn,Nn);var Yn={2:"touch",3:"pen",4:"mouse"};Xn.prototype.h=function(){Xn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Jn="closure_listenable_"+(1e6*Math.random()|0),Zn=0;function ti(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=r,this.key=++Zn,this.fa=this.ia=!1}function ei(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ni(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function ii(t){const e={};for(const n in t)e[n]=t[n];return e}const ri="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function si(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<ri.length;e++)n=ri[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function oi(t){this.src=t,this.g={},this.h=0}function ai(t,e){var n=e.type;if(n in t.g){var i,r=t.g[n],s=An(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(ei(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ci(t,e,n,i){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==i)return r}return-1}oi.prototype.add=function(t,e,n,i,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=ci(t,e,i,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new ti(e,this.src,s,!!i,r)).ia=n,t.push(e)),e};var ui="closure_lm_"+(1e6*Math.random()|0),li={};function hi(t,e,n,i,r){if(i&&i.once)return fi(t,e,n,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)hi(t,e[s],n,i,r);return null}return n=bi(n),t&&t[Jn]?t.O(e,n,vn(i)?!!i.capture:!!i,r):di(t,e,n,!1,i,r)}function di(t,e,n,i,r,s){if(!e)throw Error("Invalid event type");var o=vn(r)?!!r.capture:!!r,a=vi(t);if(a||(t[ui]=a=new oi(t)),(n=a.add(e,n,i,o,s)).proxy)return n;if(i=function(){const t=yi;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)xn||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(mi(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function fi(t,e,n,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)fi(t,e[s],n,i,r);return null}return n=bi(n),t&&t[Jn]?t.P(e,n,vn(i)?!!i.capture:!!i,r):di(t,e,n,!0,i,r)}function pi(t,e,n,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)pi(t,e[s],n,i,r);else i=vn(i)?!!i.capture:!!i,n=bi(n),t&&t[Jn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ci(s=t.g[e],n,i,r))&&(ei(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=vi(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ci(e,n,i,r)),(n=-1<t?e[t]:null)&&gi(n))}function gi(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Jn])ai(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(mi(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=vi(e))?(ai(n,t),0==n.h&&(n.src=null,e[ui]=null)):ei(t)}}}function mi(t){return t in li?li[t]:li[t]="on"+t}function yi(t,e){if(t.fa)t=!0;else{e=new Xn(e,this);var n=t.listener,i=t.la||t.src;t.ia&&gi(t),t=n.call(i,e)}return t}function vi(t){return(t=t[ui])instanceof oi?t:null}var wi="__closure_events_fn_"+(1e9*Math.random()>>>0);function bi(t){return"function"==typeof t?t:(t[wi]||(t[wi]=function(e){return t.handleEvent(e)}),t[wi])}function Ei(){Cn.call(this),this.i=new oi(this),this.S=this,this.J=null}function Ti(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Nn(e,t);else if(e instanceof Nn)e.target=e.target||t;else{var r=e;si(e=new Nn(i,t),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];r=_i(o,i,!0,e)&&r}if(r=_i(o=e.g=t,i,!0,e)&&r,r=_i(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)r=_i(o=e.g=n[s],i,!1,e)&&r}function _i(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ai(t.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Sn(Ei,Cn),Ei.prototype[Jn]=!0,Ei.prototype.removeEventListener=function(t,e,n,i){pi(this,t,e,n,i)},Ei.prototype.N=function(){if(Ei.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)ei(n[i]);delete e.g[t],e.h--}}this.J=null},Ei.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},Ei.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var Ii=mn.JSON.stringify;function Si(){var t=Ri;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ci=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ai),(t=>t.reset()));class Ai{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Di(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function ki(t){mn.setTimeout((()=>{throw t}),0)}let Ni,xi=!1,Ri=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ci.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Li=()=>{const t=mn.Promise.resolve(void 0);Ni=()=>{t.then(Mi)}};var Mi=()=>{for(var t;t=Si();){try{t.h.call(t.g)}catch(t){ki(t)}var e=Ci;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}xi=!1};function Oi(t,e){Ei.call(this),this.h=t||1,this.g=e||mn,this.j=_n(this.qb,this),this.l=Date.now()}function Pi(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Fi(t,e,n){if("function"==typeof t)n&&(t=_n(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_n(t.handleEvent,t)}return 2147483647<Number(e)?-1:mn.setTimeout(t,e||0)}function Vi(t){t.g=Fi((()=>{t.g=null,t.i&&(t.i=!1,Vi(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Sn(Oi,Ei),(dn=Oi.prototype).ga=!1,dn.T=null,dn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ti(this,"tick"),this.ga&&(Pi(this),this.start()))}},dn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},dn.N=function(){Oi.$.N.call(this),Pi(this),delete this.g};class qi extends Cn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Vi(this)}N(){super.N(),this.g&&(mn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ui(t){Cn.call(this),this.h=t,this.g={}}Sn(Ui,Cn);var Bi=[];function zi(t,e,n,i){Array.isArray(n)||(n&&(Bi[0]=n.toString()),n=Bi);for(var r=0;r<n.length;r++){var s=hi(e,n[r],i||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function ji(t){ni(t.g,(function(t,e){this.g.hasOwnProperty(e)&&gi(t)}),t),t.g={}}function $i(){this.g=!0}function Ki(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Ii(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Ui.prototype.N=function(){Ui.$.N.call(this),ji(this)},Ui.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},$i.prototype.Ea=function(){this.g=!1},$i.prototype.info=function(){};var Hi={},Gi=null;function Qi(){return Gi=Gi||new Ei}function Wi(t){Nn.call(this,Hi.Ta,t)}function Xi(t){const e=Qi();Ti(e,new Wi(e))}function Yi(t,e){Nn.call(this,Hi.STAT_EVENT,t),this.stat=e}function Ji(t){const e=Qi();Ti(e,new Yi(e,t))}function Zi(t,e){Nn.call(this,Hi.Ua,t),this.size=e}function tr(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return mn.setTimeout((function(){t()}),e)}Hi.Ta="serverreachability",Sn(Wi,Nn),Hi.STAT_EVENT="statevent",Sn(Yi,Nn),Hi.Ua="timingevent",Sn(Zi,Nn);var er={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},nr={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ir(){}function rr(t){return t.h||(t.h=t.i())}function sr(){}ir.prototype.h=null;var or,ar={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function cr(){Nn.call(this,"d")}function ur(){Nn.call(this,"c")}function lr(){}function hr(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Ui(this),this.P=fr,t=zn?125:void 0,this.V=new Oi(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new dr}function dr(){this.i=null,this.g="",this.h=!1}Sn(cr,Nn),Sn(ur,Nn),Sn(lr,ir),lr.prototype.g=function(){return new XMLHttpRequest},lr.prototype.i=function(){return{}},or=new lr;var fr=45e3,pr={},gr={};function mr(t,e,n){t.L=1,t.A=Or(Nr(e)),t.u=n,t.S=!0,yr(t,null)}function yr(t,e){t.G=Date.now(),Er(t),t.B=Nr(t.A);var n=t.B,i=t.W;Array.isArray(i)||(i=[String(i)]),Qr(n.i,"t",i),t.o=0,n=t.l.J,t.h=new dr,t.g=Qs(t.l,n?e:null,!t.u),0<t.O&&(t.M=new qi(_n(t.Pa,t,t.g),t.O)),zi(t.U,t.g,"readystatechange",t.nb),e=t.I?ii(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Xi(),function(t,e,n,i,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function vr(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function wr(t,e,n){let i,r=!0;for(;!t.J&&t.o<n.length;){if(i=br(t,n),i==gr){4==e&&(t.s=4,Ji(14),r=!1),Ki(t.j,t.m,null,"[Incomplete Response]");break}if(i==pr){t.s=4,Ji(15),Ki(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Ki(t.j,t.m,i,null),Cr(t,i)}vr(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Ji(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Us(e),e.M=!0,Ji(11))):(Ki(t.j,t.m,n,"[Invalid Chunked Response]"),Sr(t),Ir(t))}function br(t,e){var n=t.o,i=e.indexOf("\n",n);return-1==i?gr:(n=Number(e.substring(n,i)),isNaN(n)?pr:(i+=1)+n>e.length?gr:(e=e.slice(i,i+n),t.o=i+n,e))}function Er(t){t.Y=Date.now()+t.P,Tr(t,t.P)}function Tr(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=tr(_n(t.lb,t),e)}function _r(t){t.C&&(mn.clearTimeout(t.C),t.C=null)}function Ir(t){0==t.l.H||t.J||js(t.l,t)}function Sr(t){_r(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Pi(t.V),ji(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Cr(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||es(n.i,t)))if(!t.K&&es(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;zs(n),Rs(n)}qs(n),Ji(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=tr(_n(n.ib,n),6e3));if(1>=ts(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Ks(n,11)}else if((t.K||n.g==t)&&zs(n),!Rn(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let u=r[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=u[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(i=1.5*l,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=i.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ns(s,s.h),s.h=null))}if(i.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Mr(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=Gs(i,i.J?i.pa:null,i.Y),o.K){is(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.C&&(_r(a),Er(a)),i.g=o}else Vs(i);0<n.j.length&&Ms(n)}else"stop"!=u[0]&&"close"!=u[0]||Ks(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Ks(n,7):xs(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Xi()}catch(t){}}function Ar(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(yn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(yn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(yn(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],n&&n[s],t)}(dn=hr.prototype).setTimeout=function(t){this.P=t},dn.nb=function(t){t=t.target;const e=this.M;e&&3==Ss(t)?e.l():this.Pa(t)},dn.Pa=function(t){try{if(t==this.g)t:{const l=Ss(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||zn||this.g&&(this.h.h||this.g.ja()||Cs(this.g)))){this.J||4!=l||7==e||Xi(),_r(this);var n=this.g.da();this.ca=n;e:if(vr(this)){var i=Cs(this.g);t="";var r=i.length,s=4==Ss(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Sr(this),Ir(this);var o="";break e}this.h.i=new mn.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,r,s,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Rn(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,Ji(12),Sr(this),Ir(this);break t}Ki(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cr(this,n)}this.S?(wr(this,l,o),zn&&this.i&&3==l&&(zi(this.U,this.V,"tick",this.mb),this.V.start())):(Ki(this.j,this.m,o,null),Cr(this,o)),4==l&&Sr(this),this.i&&!this.J&&(4==l?js(this.l,this):(this.i=!1,Er(this)))}else(function(t){const e={};t=(t.g&&2<=Ss(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(Rn(t[i]))continue;var n=Di(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[r]||[];e[r]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Ji(12)):(this.s=0,Ji(13)),Sr(this),Ir(this)}}}catch(t){}},dn.mb=function(){if(this.g){var t=Ss(this.g),e=this.g.ja();this.o<e.length&&(_r(this),wr(this,t,e),this.i&&4!=t&&Er(this))}},dn.cancel=function(){this.J=!0,Sr(this)},dn.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Xi(),Ji(17)),Sr(this),this.s=2,Ir(this)):Tr(this,this.Y-t)};var Dr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kr(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof kr){this.h=t.h,xr(this,t.j),this.s=t.s,this.g=t.g,Rr(this,t.m),this.l=t.l;var e=t.i,n=new $r;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Lr(this,n),this.o=t.o}else t&&(e=String(t).match(Dr))?(this.h=!1,xr(this,e[1]||"",!0),this.s=Pr(e[2]||""),this.g=Pr(e[3]||"",!0),Rr(this,e[4]),this.l=Pr(e[5]||"",!0),Lr(this,e[6]||"",!0),this.o=Pr(e[7]||"")):(this.h=!1,this.i=new $r(null,this.h))}function Nr(t){return new kr(t)}function xr(t,e,n){t.j=n?Pr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Rr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Lr(t,e,n){e instanceof $r?(t.i=e,function(t,e){e&&!t.j&&(Kr(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Hr(this,e),Qr(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Fr(e,zr)),t.i=new $r(e,t.h))}function Mr(t,e,n){t.i.set(e,n)}function Or(t){return Mr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Pr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Fr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Vr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Vr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}kr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Fr(e,qr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Fr(e,qr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Fr(n,"/"==n.charAt(0)?Br:Ur,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Fr(n,jr)),t.join("")};var qr=/[#\/\?@]/g,Ur=/[#\?:]/g,Br=/[#\?]/g,zr=/[#\?@]/g,jr=/#/g;function $r(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Kr(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Hr(t,e){Kr(t),e=Wr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Gr(t,e){return Kr(t),e=Wr(t,e),t.g.has(e)}function Qr(t,e,n){Hr(t,e),0<n.length&&(t.i=null,t.g.set(Wr(t,e),Dn(n)),t.h+=n.length)}function Wr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(dn=$r.prototype).add=function(t,e){Kr(this),this.i=null,t=Wr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},dn.forEach=function(t,e){Kr(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},dn.ta=function(){Kr(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const r=t[i];for(let t=0;t<r.length;t++)n.push(e[i])}return n},dn.Z=function(t){Kr(this);let e=[];if("string"==typeof t)Gr(this,t)&&(e=e.concat(this.g.get(Wr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},dn.set=function(t,e){return Kr(this),this.i=null,Gr(this,t=Wr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},dn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},dn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),t.push(r)}}return this.i=t.join("&")};var Xr=class{constructor(t,e){this.g=t,this.map=e}};function Yr(t){this.l=t||Jr,t=mn.PerformanceNavigationTiming?0<(t=mn.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(mn.g&&mn.g.Ka&&mn.g.Ka()&&mn.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Jr=10;function Zr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ts(t){return t.h?1:t.g?t.g.size:0}function es(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ns(t,e){t.g?t.g.add(e):t.h=e}function is(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function rs(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Dn(t.i)}Yr.prototype.cancel=function(){if(this.i=rs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ss=class{stringify(t){return mn.JSON.stringify(t,void 0)}parse(t){return mn.JSON.parse(t,void 0)}};function os(){this.g=new ss}function as(t,e,n){const i=n||"";try{Ar(t,(function(t,n){let r=t;vn(t)&&(r=Ii(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function cs(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}function us(t){this.l=t.ec||null,this.j=t.ob||!1}function ls(t,e){Ei.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=hs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Sn(us,ir),us.prototype.g=function(){return new ls(this.l,this.j)},us.prototype.i=function(t){return function(){return t}}({}),Sn(ls,Ei);var hs=0;function ds(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function fs(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ps(t)}function ps(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(dn=ls.prototype).open=function(t,e){if(this.readyState!=hs)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ps(this)},dn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||mn).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},dn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,fs(this)),this.readyState=hs},dn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ps(this)),this.g&&(this.readyState=3,ps(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==mn.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ds(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},dn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?fs(this):ps(this),3==this.readyState&&ds(this)}},dn.Za=function(t){this.g&&(this.response=this.responseText=t,fs(this))},dn.Ya=function(t){this.g&&(this.response=t,fs(this))},dn.ka=function(){this.g&&fs(this)},dn.setRequestHeader=function(t,e){this.v.append(t,e)},dn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},dn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(ls.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var gs=mn.JSON.parse;function ms(t){Ei.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ys,this.L=this.M=!1}Sn(ms,Ei);var ys="",vs=/^https?$/i,ws=["POST","PUT"];function bs(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Es(t),_s(t)}function Es(t){t.F||(t.F=!0,Ti(t,"complete"),Ti(t,"error"))}function Ts(t){if(t.h&&void 0!==gn&&(!t.C[1]||4!=Ss(t)||2!=t.da()))if(t.v&&4==Ss(t))Fi(t.La,0,t);else if(Ti(t,"readystatechange"),4==Ss(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var r=String(t.I).match(Dr)[1]||null;!r&&mn.self&&mn.self.location&&(r=mn.self.location.protocol.slice(0,-1)),i=!vs.test(r?r.toLowerCase():"")}n=i}if(n)Ti(t,"complete"),Ti(t,"success");else{t.m=6;try{var s=2<Ss(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Es(t)}}finally{_s(t)}}}function _s(t,e){if(t.g){Is(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ti(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function Is(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(mn.clearTimeout(t.A),t.A=null)}function Ss(t){return t.g?t.g.readyState:0}function Cs(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case ys:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function As(t){let e="";return ni(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ds(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=As(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Mr(t,e,n))}function ks(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ns(t){this.Ga=0,this.j=[],this.l=new $i,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ks("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ks("baseRetryDelayMs",5e3,t),this.hb=ks("retryDelaySeedMs",1e4,t),this.eb=ks("forwardChannelMaxRetries",2,t),this.xa=ks("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Yr(t&&t.concurrentRequestLimit),this.Ja=new os,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function xs(t){if(Ls(t),3==t.H){var e=t.W++,n=Nr(t.I);if(Mr(n,"SID",t.K),Mr(n,"RID",e),Mr(n,"TYPE","terminate"),Ps(t,n),(e=new hr(t,t.l,e)).L=2,e.A=Or(Nr(n)),n=!1,mn.navigator&&mn.navigator.sendBeacon)try{n=mn.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&mn.Image&&((new Image).src=e.A,n=!0),n||(e.g=Qs(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Er(e)}Hs(t)}function Rs(t){t.g&&(Us(t),t.g.cancel(),t.g=null)}function Ls(t){Rs(t),t.u&&(mn.clearTimeout(t.u),t.u=null),zs(t),t.i.cancel(),t.m&&("number"==typeof t.m&&mn.clearTimeout(t.m),t.m=null)}function Ms(t){if(!Zr(t.i)&&!t.m){t.m=!0;var e=t.Na;Ni||Li(),xi||(Ni(),xi=!0),Ri.add(e,t),t.C=0}}function Os(t,e){var n;n=e?e.m:t.W++;const i=Nr(t.I);Mr(i,"SID",t.K),Mr(i,"RID",n),Mr(i,"AID",t.V),Ps(t,i),t.o&&t.s&&Ds(i,t.o,t.s),n=new hr(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Fs(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),ns(t.i,n),mr(n,i,e)}function Ps(t,e){t.na&&ni(t.na,(function(t,n){Mr(e,n,t)})),t.h&&Ar({},(function(t,n){Mr(e,n,t)}))}function Fs(t,e,n){n=Math.min(t.j.length,n);var i=t.h?_n(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),s=!1;else try{as(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(s){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Vs(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ni||Li(),xi||(Ni(),xi=!0),Ri.add(e,t),t.A=0}}function qs(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=tr(_n(t.Ma,t),$s(t,t.A)),t.A++,0))}function Us(t){null!=t.B&&(mn.clearTimeout(t.B),t.B=null)}function Bs(t){t.g=new hr(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Nr(t.wa);Mr(e,"RID","rpc"),Mr(e,"SID",t.K),Mr(e,"AID",t.V),Mr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Mr(e,"TO",t.qa),Mr(e,"TYPE","xmlhttp"),Ps(t,e),t.o&&t.s&&Ds(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Or(Nr(e)),n.u=null,n.S=!0,yr(n,t)}function zs(t){null!=t.v&&(mn.clearTimeout(t.v),t.v=null)}function js(t,e){var n=null;if(t.g==e){zs(t),Us(t),t.g=null;var i=2}else{if(!es(t.i,e))return;n=e.F,is(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.u?e.u.length:0,e=Date.now()-e.G;var r=t.C;Ti(i=Qi(),new Zi(i,n)),Ms(t)}else Vs(t);else if(3==(r=e.s)||0==r&&0<e.ca||!(1==i&&function(t,e){return!(ts(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=tr(_n(t.Na,t,e),$s(t,t.C)),t.C++,0)))}(t,e)||2==i&&qs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Ks(t,5);break;case 4:Ks(t,10);break;case 3:Ks(t,6);break;default:Ks(t,2)}}function $s(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Ks(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=_n(t.pb,t);n||(n=new kr("//www.google.com/images/cleardot.gif"),mn.location&&"http"==mn.location.protocol||xr(n,"https"),Or(n)),function(t,e){const n=new $i;if(mn.Image){const i=new Image;i.onload=In(cs,n,i,"TestLoadImage: loaded",!0,e),i.onerror=In(cs,n,i,"TestLoadImage: error",!1,e),i.onabort=In(cs,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=In(cs,n,i,"TestLoadImage: timeout",!1,e),mn.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Ji(2);t.H=0,t.h&&t.h.za(e),Hs(t),Ls(t)}function Hs(t){if(t.H=0,t.ma=[],t.h){const e=rs(t.i);0==e.length&&0==t.j.length||(kn(t.ma,e),kn(t.ma,t.j),t.i.i.length=0,Dn(t.j),t.j.length=0),t.h.ya()}}function Gs(t,e,n){var i=n instanceof kr?Nr(n):new kr(n);if(""!=i.g)e&&(i.g=e+"."+i.g),Rr(i,i.m);else{var r=mn.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new kr(null);i&&xr(s,i),e&&(s.g=e),r&&Rr(s,r),n&&(s.l=n),i=s}return n=t.F,e=t.Da,n&&e&&Mr(i,n,e),Mr(i,"VER",t.ra),Ps(t,i),i}function Qs(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new ms(new us({ob:n})):new ms(t.va)).Oa(t.J),e}function Ws(){}function Xs(){if(Un&&!(10<=Number(Wn)))throw Error("Environmental error: no available transport.")}function Ys(t,e){Ei.call(this),this.g=new Ns(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Rn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Rn(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new to(this)}function Js(t){cr.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Zs(){ur.call(this),this.status=1}function to(t){this.g=t}function eo(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function no(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function io(t,e){this.h=e;for(var n=[],i=!0,r=t.length-1;0<=r;r--){var s=0|t[r];i&&s==e||(n[r]=s,i=!1)}this.g=n}(dn=ms.prototype).Oa=function(t){this.M=t},dn.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():or.g(),this.C=this.u?rr(this.u):rr(or),this.g.onreadystatechange=_n(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void bs(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=mn.FormData&&t instanceof mn.FormData,!(0<=An(ws,e))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Is(this),0<this.B&&((this.L=function(t){return Un&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_n(this.ua,this)):this.A=Fi(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){bs(this,t)}},dn.ua=function(){void 0!==gn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ti(this,"timeout"),this.abort(8))},dn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ti(this,"complete"),Ti(this,"abort"),_s(this))},dn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_s(this,!0)),ms.$.N.call(this)},dn.La=function(){this.s||(this.G||this.v||this.l?Ts(this):this.kb())},dn.kb=function(){Ts(this)},dn.isActive=function(){return!!this.g},dn.da=function(){try{return 2<Ss(this)?this.g.status:-1}catch(t){return-1}},dn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},dn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),gs(e)}},dn.Ia=function(){return this.m},dn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(dn=Ns.prototype).ra=8,dn.H=1,dn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new hr(this,this.l,t);let s=this.s;if(this.U&&(s?(s=ii(s),si(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Fs(this,r,e),Mr(n=Nr(this.I),"RID",t),Mr(n,"CVER",22),this.F&&Mr(n,"X-HTTP-Session-Id",this.F),Ps(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(As(s)))+"&"+e:this.o&&Ds(n,this.o,s)),ns(this.i,r),this.bb&&Mr(n,"TYPE","init"),this.P?(Mr(n,"$req",e),Mr(n,"SID","null"),r.aa=!0,mr(r,n,null)):mr(r,n,e),this.H=2}}else 3==this.H&&(t?Os(this,t):0==this.j.length||Zr(this.i)||Os(this))},dn.Ma=function(){if(this.u=null,Bs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=tr(_n(this.jb,this),t)}},dn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ji(10),Rs(this),Bs(this))},dn.ib=function(){null!=this.v&&(this.v=null,Rs(this),qs(this),Ji(19))},dn.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Ji(2)):(this.l.info("Failed to ping google.com"),Ji(1))},dn.isActive=function(){return!!this.h&&this.h.isActive(this)},(dn=Ws.prototype).Ba=function(){},dn.Aa=function(){},dn.za=function(){},dn.ya=function(){},dn.isActive=function(){return!0},dn.Va=function(){},Xs.prototype.g=function(t,e){return new Ys(t,e)},Sn(Ys,Ei),Ys.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Ji(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Gs(t,null,t.Y),Ms(t)},Ys.prototype.close=function(){xs(this.g)},Ys.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ii(t),t=n);e.j.push(new Xr(e.fb++,t)),3==e.H&&Ms(e)},Ys.prototype.N=function(){this.g.h=null,delete this.j,xs(this.g),delete this.g,Ys.$.N.call(this)},Sn(Js,cr),Sn(Zs,ur),Sn(to,Ws),to.prototype.Ba=function(){Ti(this.g,"a")},to.prototype.Aa=function(t){Ti(this.g,new Js(t))},to.prototype.za=function(t){Ti(this.g,new Zs)},to.prototype.ya=function(){Ti(this.g,"b")},Sn(eo,(function(){this.blockSize=-1})),eo.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},eo.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=n;)no(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r++]=t.charCodeAt(s++),r==this.blockSize){no(this,i),r=0;break}}else for(;s<e;)if(i[r++]=t[s++],r==this.blockSize){no(this,i),r=0;break}}this.h=r,this.i+=e},eo.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var ro={};function so(t){return-128<=t&&128>t?function(t,e){var n=ro;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new io([0|t],0>t?-1:0)}(t)}(t):new io([0|t],0>t?-1:0)}function oo(t){if(isNaN(t)||!isFinite(t))return co;if(0>t)return po(oo(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=ao;return new io(e,0)}var ao=4294967296,co=so(0),uo=so(1),lo=so(16777216);function ho(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function fo(t){return-1==t.h}function po(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new io(n,~t.h).add(uo)}function go(t,e){return t.add(po(e))}function mo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function yo(t,e){this.g=t,this.h=e}function vo(t,e){if(ho(e))throw Error("division by zero");if(ho(t))return new yo(co,co);if(fo(t))return e=vo(po(t),e),new yo(po(e.g),po(e.h));if(fo(e))return e=vo(t,po(e)),new yo(po(e.g),e.h);if(30<t.g.length){if(fo(t)||fo(e))throw Error("slowDivide_ only works with positive integers.");for(var n=uo,i=e;0>=i.X(t);)n=wo(n),i=wo(i);var r=bo(n,1),s=bo(i,1);for(i=bo(i,2),n=bo(n,2);!ho(i);){var o=s.add(i);0>=o.X(t)&&(r=r.add(n),s=o),i=bo(i,1),n=bo(n,1)}return e=go(t,r.R(e)),new yo(r,e)}for(r=co;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=oo(n)).R(e);fo(o)||0<o.X(t);)o=(s=oo(n-=i)).R(e);ho(s)&&(s=uo),r=r.add(s),t=go(t,o)}return new yo(r,t)}function wo(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new io(n,t.h)}function bo(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],s=0;s<i;s++)r[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new io(r,t.h)}(dn=io.prototype).ea=function(){if(fo(this))return-po(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:ao+i)*e,e*=ao}return t},dn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ho(this))return"0";if(fo(this))return"-"+po(this).toString(t);for(var e=oo(Math.pow(t,6)),n=this,i="";;){var r=vo(n,e).g,s=((0<(n=go(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ho(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},dn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},dn.X=function(t){return fo(t=go(this,t))?-1:ho(t)?0:1},dn.abs=function(){return fo(this)?po(this):this},dn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var s=i+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new io(n,-2147483648&n[n.length-1]?-1:0)},dn.R=function(t){if(ho(this)||ho(t))return co;if(fo(this))return fo(t)?po(this).R(po(t)):po(po(this).R(t));if(fo(t))return po(this.R(po(t)));if(0>this.X(lo)&&0>t.X(lo))return oo(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=t.D(r)>>>16,c=65535&t.D(r);n[2*i+2*r]+=o*c,mo(n,2*i+2*r),n[2*i+2*r+1]+=s*c,mo(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,mo(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,mo(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new io(n,0)},dn.gb=function(t){return vo(this,t).h},dn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new io(n,this.h&t.h)},dn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new io(n,this.h|t.h)},dn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new io(n,this.h^t.h)},Xs.prototype.createWebChannel=Xs.prototype.g,Ys.prototype.send=Ys.prototype.u,Ys.prototype.open=Ys.prototype.m,Ys.prototype.close=Ys.prototype.close,er.NO_ERROR=0,er.TIMEOUT=8,er.HTTP_ERROR=6,nr.COMPLETE="complete",sr.EventType=ar,ar.OPEN="a",ar.CLOSE="b",ar.ERROR="c",ar.MESSAGE="d",Ei.prototype.listen=Ei.prototype.O,ms.prototype.listenOnce=ms.prototype.P,ms.prototype.getLastError=ms.prototype.Sa,ms.prototype.getLastErrorCode=ms.prototype.Ia,ms.prototype.getStatus=ms.prototype.da,ms.prototype.getResponseJson=ms.prototype.Wa,ms.prototype.getResponseText=ms.prototype.ja,ms.prototype.send=ms.prototype.ha,ms.prototype.setWithCredentials=ms.prototype.Oa,eo.prototype.digest=eo.prototype.l,eo.prototype.reset=eo.prototype.reset,eo.prototype.update=eo.prototype.j,io.prototype.add=io.prototype.add,io.prototype.multiply=io.prototype.R,io.prototype.modulo=io.prototype.gb,io.prototype.compare=io.prototype.X,io.prototype.toNumber=io.prototype.ea,io.prototype.toString=io.prototype.toString,io.prototype.getBits=io.prototype.D,io.fromNumber=oo,io.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return po(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=oo(Math.pow(n,8)),r=co,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=oo(Math.pow(n,o)),r=r.R(o).add(oo(a))):r=(r=r.R(i)).add(oo(a))}return r};var Eo=pn.createWebChannelTransport=function(){return new Xs},To=pn.getStatEventTarget=function(){return Qi()},_o=pn.ErrorCode=er,Io=pn.EventType=nr,So=pn.Event=Hi,Co=pn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ao=pn.FetchXmlHttpFactory=us,Do=pn.WebChannel=sr,ko=pn.XhrIo=ms,No=pn.Md5=eo,xo=pn.Integer=io;const Ro="@firebase/firestore";class Lo{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Lo.UNAUTHENTICATED=new Lo(null),Lo.GOOGLE_CREDENTIALS=new Lo("google-credentials-uid"),Lo.FIRST_PARTY=new Lo("first-party-uid"),Lo.MOCK_USER=new Lo("mock-user");let Mo="10.11.1";const Oo=new x("@firebase/firestore");function Po(){return Oo.logLevel}function Fo(t,...e){if(Oo.logLevel<=C.DEBUG){const n=e.map(Uo);Oo.debug(`Firestore (${Mo}): ${t}`,...n)}}function Vo(t,...e){if(Oo.logLevel<=C.ERROR){const n=e.map(Uo);Oo.error(`Firestore (${Mo}): ${t}`,...n)}}function qo(t,...e){if(Oo.logLevel<=C.WARN){const n=e.map(Uo);Oo.warn(`Firestore (${Mo}): ${t}`,...n)}}function Uo(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Bo(t="Unexpected state"){const e=`FIRESTORE (${Mo}) INTERNAL ASSERTION FAILED: `+t;throw Vo(e),new Error(e)}function zo(t,e){t||Bo()}function jo(t,e){return t}const $o={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ko extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ho{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Go{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Qo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Lo.UNAUTHENTICATED)))}shutdown(){}}class Wo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Xo{constructor(t){this.t=t,this.currentUser=Lo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new Ho;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Ho,t.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Fo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Fo("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Ho)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Fo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(zo("string"==typeof e.accessToken),new Go(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return zo(null===t||"string"==typeof t),new Lo(t)}}class Yo{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Lo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Jo{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Yo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Lo.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Zo{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ta{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Fo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Fo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Fo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?i(t):Fo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(zo("string"==typeof t.token),this.R=t.token,new Zo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ea(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class na{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ea(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function ia(t,e){return t<e?-1:t>e?1:0}function ra(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class sa{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ko($o.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ko($o.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ko($o.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ko($o.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return sa.fromMillis(Date.now())}static fromDate(t){return sa.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new sa(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ia(this.nanoseconds,t.nanoseconds):ia(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class oa{constructor(t){this.timestamp=t}static fromTimestamp(t){return new oa(t)}static min(){return new oa(new sa(0,0))}static max(){return new oa(new sa(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class aa{constructor(t,e,n){void 0===e?e=0:e>t.length&&Bo(),void 0===n?n=t.length-e:n>t.length-e&&Bo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===aa.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof aa?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),r=e.get(i);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ca extends aa{construct(t,e,n){return new ca(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ko($o.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ca(e)}static emptyPath(){return new ca([])}}const ua=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class la extends aa{construct(t,e,n){return new la(t,e,n)}static isValidIdentifier(t){return ua.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),la.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new la(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new Ko($o.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new Ko($o.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ko($o.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(s=!s,i++):"."!==e||s?(n+=e,i++):(r(),i++)}if(r(),s)throw new Ko($o.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new la(e)}static emptyPath(){return new la([])}}class ha{constructor(t){this.path=t}static fromPath(t){return new ha(ca.fromString(t))}static fromName(t){return new ha(ca.fromString(t).popFirst(5))}static empty(){return new ha(ca.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ca.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ca.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ha(new ca(t.slice()))}}function da(t){return new fa(t.readTime,t.key,-1)}class fa{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new fa(oa.min(),ha.empty(),-1)}static max(){return new fa(oa.max(),ha.empty(),-1)}}function pa(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ha.comparator(t.documentKey,e.documentKey),0!==n?n:ia(t.largestBatchId,e.largestBatchId))}const ga="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ma{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function ya(t){if(t.code!==$o.FAILED_PRECONDITION||t.message!==ga)throw t;Fo("LocalStore","Unexpectedly lost primary lease")}class va{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Bo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new va(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof va?e:va.resolve(e)}catch(t){return va.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):va.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):va.reject(e)}static resolve(t){return new va(((e,n)=>{e(t)}))}static reject(t){return new va(((e,n)=>{n(t)}))}static waitFor(t){return new va(((e,n)=>{let i=0,r=0,s=!1;t.forEach((t=>{++i,t.next((()=>{++r,s&&r===i&&e()}),(t=>n(t)))})),s=!0,r===i&&e()}))}static or(t){let e=va.resolve(!1);for(const n of t)e=e.next((t=>t?va.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new va(((n,i)=>{const r=t.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===r&&n(s)}),(t=>i(t)))}}))}static doWhile(t,e){return new va(((n,i)=>{const r=()=>{!0===t()?e().next((()=>{r()}),i):n()};r()}))}}function wa(t){return"IndexedDbTransactionError"===t.name}class ba{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Ea(t){return null==t}function Ta(t){return 0===t&&1/t==-1/0}ba.oe=-1;function _a(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ia(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Sa(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Ca{constructor(t,e){this.comparator=t,this.root=e||Da.EMPTY}insert(t,e){return new Ca(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Da.BLACK,null,null))}remove(t){return new Ca(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Da.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Aa(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Aa(this.root,t,this.comparator,!1)}getReverseIterator(){return new Aa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Aa(this.root,t,this.comparator,!0)}}class Aa{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Da{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:Da.RED,this.left=null!=i?i:Da.EMPTY,this.right=null!=r?r:Da.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new Da(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Da.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Da.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Da.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Da.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Bo();if(this.right.isRed())throw Bo();const t=this.left.check();if(t!==this.right.check())throw Bo();return t+(this.isRed()?0:1)}}Da.EMPTY=null,Da.RED=!0,Da.BLACK=!1,Da.EMPTY=new class{constructor(){this.size=0}get key(){throw Bo()}get value(){throw Bo()}get color(){throw Bo()}get left(){throw Bo()}get right(){throw Bo()}copy(t,e,n,i,r){return this}insert(t,e,n){return new Da(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ka{constructor(t){this.comparator=t,this.data=new Ca(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Na(this.data.getIterator())}getIteratorFrom(t){return new Na(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof ka))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ka(this.comparator);return e.data=t,e}}class Na{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xa{constructor(t){this.fields=t,t.sort(la.comparator)}static empty(){return new xa([])}unionWith(t){let e=new ka(la.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new xa(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ra(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Ra extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class La{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ra("Invalid base64 string: "+t):t}}(t);return new La(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new La(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ia(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}La.EMPTY_BYTE_STRING=new La("");const Ma=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Oa(t){if(zo(!!t),"string"==typeof t){let e=0;const n=Ma.exec(t);if(zo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Pa(t.seconds),nanos:Pa(t.nanos)}}function Pa(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Fa(t){return"string"==typeof t?La.fromBase64String(t):La.fromUint8Array(t)}function Va(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function qa(t){const e=t.mapValue.fields.__previous_value__;return Va(e)?qa(e):e}function Ua(t){const e=Oa(t.mapValue.fields.__local_write_time__.timestampValue);return new sa(e.seconds,e.nanos)}class Ba{constructor(t,e,n,i,r,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class za{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new za("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof za&&t.projectId===this.projectId&&t.database===this.database}}const ja={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function $a(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Va(t)?4:ic(t)?9007199254740991:10:Bo()}function Ka(t,e){if(t===e)return!0;const n=$a(t);if(n!==$a(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ua(t).isEqual(Ua(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Oa(t.timestampValue),i=Oa(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Fa(t.bytesValue).isEqual(Fa(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Pa(t.geoPointValue.latitude)===Pa(e.geoPointValue.latitude)&&Pa(t.geoPointValue.longitude)===Pa(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Pa(t.integerValue)===Pa(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Pa(t.doubleValue),i=Pa(e.doubleValue);return n===i?Ta(n)===Ta(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return ra(t.arrayValue.values||[],e.arrayValue.values||[],Ka);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(_a(n)!==_a(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Ka(n[t],i[t])))return!1;return!0}(t,e);default:return Bo()}}function Ha(t,e){return void 0!==(t.values||[]).find((t=>Ka(t,e)))}function Ga(t,e){if(t===e)return 0;const n=$a(t),i=$a(e);if(n!==i)return ia(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return ia(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Pa(t.integerValue||t.doubleValue),i=Pa(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Qa(t.timestampValue,e.timestampValue);case 4:return Qa(Ua(t),Ua(e));case 5:return ia(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Fa(t),i=Fa(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=ia(n[t],i[t]);if(0!==e)return e}return ia(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ia(Pa(t.latitude),Pa(e.latitude));return 0!==n?n:ia(Pa(t.longitude),Pa(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Ga(n[t],i[t]);if(e)return e}return ia(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===ja.mapValue&&e===ja.mapValue)return 0;if(t===ja.mapValue)return 1;if(e===ja.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let t=0;t<i.length&&t<s.length;++t){const e=ia(i[t],s[t]);if(0!==e)return e;const o=Ga(n[i[t]],r[s[t]]);if(0!==o)return o}return ia(i.length,s.length)}(t.mapValue,e.mapValue);default:throw Bo()}}function Qa(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ia(t,e);const n=Oa(t),i=Oa(e),r=ia(n.seconds,i.seconds);return 0!==r?r:ia(n.nanos,i.nanos)}function Wa(t){return Xa(t)}function Xa(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Oa(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Fa(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ha.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=Xa(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${Xa(t.fields[r])}`;return n+"}"}(t.mapValue):Bo()}function Ya(t){return!!t&&"integerValue"in t}function Ja(t){return!!t&&"arrayValue"in t}function Za(t){return!!t&&"nullValue"in t}function tc(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ec(t){return!!t&&"mapValue"in t}function nc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ia(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=nc(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=nc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ic(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class rc{constructor(t){this.value=t}static empty(){return new rc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ec(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=nc(e)}setAll(t){let e=la.emptyPath(),n={},i=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=nc(t):i.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());ec(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ka(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];ec(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Ia(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new rc(nc(this.value))}}function sc(t){const e=[];return Ia(t.fields,((t,n)=>{const i=new la([t]);if(ec(n)){const t=sc(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new xa(e)}class oc{constructor(t,e,n,i,r,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(t){return new oc(t,0,oa.min(),oa.min(),oa.min(),rc.empty(),0)}static newFoundDocument(t,e,n,i){return new oc(t,1,e,oa.min(),n,i,0)}static newNoDocument(t,e){return new oc(t,2,e,oa.min(),oa.min(),rc.empty(),0)}static newUnknownDocument(t,e){return new oc(t,3,e,oa.min(),oa.min(),rc.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(oa.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=rc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=rc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=oa.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof oc&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new oc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ac{constructor(t,e){this.position=t,this.inclusive=e}}function cc(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(i=s.field.isKeyField()?ha.comparator(ha.fromName(o.referenceValue),n.key):Ga(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function uc(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ka(t.position[n],e.position[n]))return!1;return!0}class lc{constructor(t,e="asc"){this.field=t,this.dir=e}}function hc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class dc{}class fc extends dc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new bc(t,e,n):"array-contains"===e?new Ic(t,n):"in"===e?new Sc(t,n):"not-in"===e?new Cc(t,n):"array-contains-any"===e?new Ac(t,n):new fc(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ec(t,n):new Tc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Ga(e,this.value)):null!==e&&$a(this.value)===$a(e)&&this.matchesComparison(Ga(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Bo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class pc extends dc{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new pc(t,e)}matches(t){return gc(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function gc(t){return"and"===t.op}function mc(t){return function(t){for(const e of t.filters)if(e instanceof pc)return!1;return!0}(t)&&gc(t)}function yc(t){if(t instanceof fc)return t.field.canonicalString()+t.op.toString()+Wa(t.value);if(mc(t))return t.filters.map((t=>yc(t))).join(",");{const e=t.filters.map((t=>yc(t))).join(",");return`${t.op}(${e})`}}function vc(t,e){return t instanceof fc?function(t,e){return e instanceof fc&&t.op===e.op&&t.field.isEqual(e.field)&&Ka(t.value,e.value)}(t,e):t instanceof pc?function(t,e){return e instanceof pc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&vc(n,e.filters[i])),!0)}(t,e):void Bo()}function wc(t){return t instanceof fc?function(t){return`${t.field.canonicalString()} ${t.op} ${Wa(t.value)}`}(t):t instanceof pc?function(t){return t.op.toString()+" {"+t.getFilters().map(wc).join(" ,")+"}"}(t):"Filter"}class bc extends fc{constructor(t,e,n){super(t,e,n),this.key=ha.fromName(n.referenceValue)}matches(t){const e=ha.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ec extends fc{constructor(t,e){super(t,"in",e),this.keys=_c(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Tc extends fc{constructor(t,e){super(t,"not-in",e),this.keys=_c(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function _c(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ha.fromName(t.referenceValue)))}class Ic extends fc{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ja(e)&&Ha(e.arrayValue,this.value)}}class Sc extends fc{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ha(this.value.arrayValue,e)}}class Cc extends fc{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ha(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ha(this.value.arrayValue,e)}}class Ac extends fc{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ja(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ha(this.value.arrayValue,t)))}}class Dc{constructor(t,e=null,n=[],i=[],r=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.ue=null}}function kc(t,e=null,n=[],i=[],r=null,s=null,o=null){return new Dc(t,e,n,i,r,s,o)}function Nc(t){const e=jo(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>yc(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ea(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Wa(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Wa(t))).join(",")),e.ue=t}return e.ue}function xc(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!hc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!vc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!uc(t.startAt,e.startAt)&&uc(t.endAt,e.endAt)}function Rc(t){return ha.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Lc{constructor(t,e=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Mc(t){return new Lc(t)}function Oc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Pc(t){const e=jo(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",i=function(t){let e=new ka(la.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);i.forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new lc(i,n))})),t.has(la.keyField().canonicalString())||e.ce.push(new lc(la.keyField(),n))}return e.ce}function Fc(t){const e=jo(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return kc(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new lc(t.field,e)}));const n=t.endAt?new ac(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new ac(t.startAt.position,t.startAt.inclusive):null;return kc(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}}(e,Pc(t))),e.le}function Vc(t,e,n){return new Lc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qc(t,e){return xc(Fc(t),Fc(e))&&t.limitType===e.limitType}function Uc(t){return`${Nc(Fc(t))}|lt:${t.limitType}`}function Bc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>wc(t))).join(", ")}]`),Ea(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Wa(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Wa(t))).join(",")),`Target(${e})`}(Fc(t))}; limitType=${t.limitType})`}function zc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ha.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Pc(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=cc(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Pc(t),e)||t.endAt&&!function(t,e,n){const i=cc(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Pc(t),e))}(t,e)}function jc(t){return(e,n)=>{let i=!1;for(const r of Pc(t)){const t=$c(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}function $c(t,e,n){const i=t.field.isKeyField()?ha.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?Ga(i,r):Bo()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Bo()}}class Kc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Ia(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Sa(this.inner)}size(){return this.innerSize}}const Hc=new Ca(ha.comparator);function Gc(){return Hc}const Qc=new Ca(ha.comparator);function Wc(...t){let e=Qc;for(const n of t)e=e.insert(n.key,n);return e}function Xc(t){let e=Qc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Yc(){return Zc()}function Jc(){return Zc()}function Zc(){return new Kc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const tu=new Ca(ha.comparator),eu=new ka(ha.comparator);function nu(...t){let e=eu;for(const n of t)e=e.add(n);return e}const iu=new ka(ia);function ru(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ta(e)?"-0":e}}function su(t){return{integerValue:""+t}}function ou(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Ta(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?su(e):ru(t,e)}class au{constructor(){this._=void 0}}function cu(t,e,n){return t instanceof hu?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Va(e)&&(e=qa(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof du?fu(t,e):t instanceof pu?gu(t,e):function(t,e){const n=lu(t,e),i=yu(n)+yu(t.Pe);return Ya(n)&&Ya(t.Pe)?su(i):ru(t.serializer,i)}(t,e)}function uu(t,e,n){return t instanceof du?fu(t,e):t instanceof pu?gu(t,e):n}function lu(t,e){return t instanceof mu?function(t){return Ya(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class hu extends au{}class du extends au{constructor(t){super(),this.elements=t}}function fu(t,e){const n=vu(e);for(const e of t.elements)n.some((t=>Ka(t,e)))||n.push(e);return{arrayValue:{values:n}}}class pu extends au{constructor(t){super(),this.elements=t}}function gu(t,e){let n=vu(e);for(const e of t.elements)n=n.filter((t=>!Ka(t,e)));return{arrayValue:{values:n}}}class mu extends au{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function yu(t){return Pa(t.integerValue||t.doubleValue)}function vu(t){return Ja(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class wu{constructor(t,e){this.version=t,this.transformResults=e}}class bu{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new bu}static exists(t){return new bu(void 0,t)}static updateTime(t){return new bu(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Eu(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Tu{}function _u(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Lu(t.key,bu.none()):new Du(t.key,t.data,bu.none());{const n=t.data,i=rc.empty();let r=new ka(la.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new ku(t.key,i,new xa(r.toArray()),bu.none())}}function Iu(t,e,n){t instanceof Du?function(t,e,n){const i=t.value.clone(),r=xu(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof ku?function(t,e,n){if(!Eu(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=xu(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(Nu(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Su(t,e,n,i){return t instanceof Du?function(t,e,n,i){if(!Eu(t.precondition,e))return n;const r=t.value.clone(),s=Ru(t.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof ku?function(t,e,n,i){if(!Eu(t.precondition,e))return n;const r=Ru(t.fieldTransforms,i,e),s=e.data;return s.setAll(Nu(t)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return Eu(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Cu(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),r=lu(i.transform,t||null);null!=r&&(null===n&&(n=rc.empty()),n.set(i.field,r))}return n||null}function Au(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ra(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof du&&e instanceof du||t instanceof pu&&e instanceof pu?ra(t.elements,e.elements,Ka):t instanceof mu&&e instanceof mu?Ka(t.Pe,e.Pe):t instanceof hu&&e instanceof hu}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Du extends Tu{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ku extends Tu{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Nu(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function xu(t,e,n){const i=new Map;zo(t.length===n.length);for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,uu(o,a,n[r]))}return i}function Ru(t,e,n){const i=new Map;for(const r of t){const t=r.transform,s=n.data.field(r.field);i.set(r.field,cu(t,s,e))}return i}class Lu extends Tu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mu extends Tu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ou{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Iu(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Su(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Su(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Jc();return this.mutations.forEach((i=>{const r=t.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=e.has(i.key)?null:o;const a=_u(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(oa.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),nu())}isEqual(t){return this.batchId===t.batchId&&ra(this.mutations,t.mutations,((t,e)=>Au(t,e)))&&ra(this.baseMutations,t.baseMutations,((t,e)=>Au(t,e)))}}class Pu{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){zo(t.mutations.length===n.length);let i=tu;const r=t.mutations;for(let t=0;t<r.length;t++)i=i.insert(r[t].key,n[t].version);return new Pu(t,e,n,i)}}class Fu{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vu{constructor(t,e){this.count=t,this.unchangedNames=e}}var qu,Uu;function Bu(t){if(void 0===t)return Vo("GRPC error has no .code"),$o.UNKNOWN;switch(t){case qu.OK:return $o.OK;case qu.CANCELLED:return $o.CANCELLED;case qu.UNKNOWN:return $o.UNKNOWN;case qu.DEADLINE_EXCEEDED:return $o.DEADLINE_EXCEEDED;case qu.RESOURCE_EXHAUSTED:return $o.RESOURCE_EXHAUSTED;case qu.INTERNAL:return $o.INTERNAL;case qu.UNAVAILABLE:return $o.UNAVAILABLE;case qu.UNAUTHENTICATED:return $o.UNAUTHENTICATED;case qu.INVALID_ARGUMENT:return $o.INVALID_ARGUMENT;case qu.NOT_FOUND:return $o.NOT_FOUND;case qu.ALREADY_EXISTS:return $o.ALREADY_EXISTS;case qu.PERMISSION_DENIED:return $o.PERMISSION_DENIED;case qu.FAILED_PRECONDITION:return $o.FAILED_PRECONDITION;case qu.ABORTED:return $o.ABORTED;case qu.OUT_OF_RANGE:return $o.OUT_OF_RANGE;case qu.UNIMPLEMENTED:return $o.UNIMPLEMENTED;case qu.DATA_LOSS:return $o.DATA_LOSS;default:return Bo()}}(Uu=qu||(qu={}))[Uu.OK=0]="OK",Uu[Uu.CANCELLED=1]="CANCELLED",Uu[Uu.UNKNOWN=2]="UNKNOWN",Uu[Uu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Uu[Uu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Uu[Uu.NOT_FOUND=5]="NOT_FOUND",Uu[Uu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Uu[Uu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Uu[Uu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Uu[Uu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Uu[Uu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Uu[Uu.ABORTED=10]="ABORTED",Uu[Uu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Uu[Uu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Uu[Uu.INTERNAL=13]="INTERNAL",Uu[Uu.UNAVAILABLE=14]="UNAVAILABLE",Uu[Uu.DATA_LOSS=15]="DATA_LOSS";const zu=new xo([4294967295,4294967295],0);function ju(t){const e=(new TextEncoder).encode(t),n=new No;return n.update(e),new Uint8Array(n.digest())}function $u(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new xo([n,i],0),new xo([r,s],0)]}class Ku{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Hu(`Invalid padding: ${e}`);if(n<0)throw new Hu(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Hu(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Hu(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=xo.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(xo.fromNumber(n)));return 1===i.compare(zu)&&(i=new xo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=ju(t),[n,i]=$u(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,i,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),s=new Ku(r,i,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Ie)return;const e=ju(t),[n,i]=$u(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,i,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Hu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Gu{constructor(t,e,n,i,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,Qu.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Gu(oa.min(),i,new Ca(ia),Gc(),nu())}}class Qu{constructor(t,e,n,i,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Qu(n,e,nu(),nu(),nu())}}class Wu{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}}class Xu{constructor(t,e){this.targetId=t,this.me=e}}class Yu{constructor(t,e,n=La.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Ju{constructor(){this.fe=0,this.ge=el(),this.pe=La.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=nu(),e=nu(),n=nu();return this.ge.forEach(((i,r)=>{switch(r){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:Bo()}})),new Qu(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=el()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,zo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Zu{constructor(t){this.Le=t,this.Be=new Map,this.ke=Gc(),this.qe=tl(),this.Qe=new Ca(ia)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:Bo()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,i=this.Je(e);if(i){const r=i.target;if(Rc(r))if(0===n){const t=new ha(r.path);this.Ue(e,t,oc.newNoDocument(t,oa.min()))}else zo(1===n);else{const i=this.Ye(e);if(i!==n){const n=this.Ze(t),r=n?this.Xe(n,t,i):1;if(0!==r){this.je(e);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:r=0}=e;let s,o;try{s=Fa(n).toUint8Array()}catch(t){if(t instanceof Ra)return qo("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Ku(s,i,r)}catch(t){return qo(t instanceof Hu?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let i=0;return n.forEach((n=>{const r=this.Le.tt(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.Ue(e,n,null),i++)})),i}rt(t){const e=new Map;this.Be.forEach(((n,i)=>{const r=this.Je(i);if(r){if(n.current&&Rc(r.target)){const e=new ha(r.target.path);null!==this.ke.get(e)||this.it(i,e)||this.Ue(i,e,oc.newNoDocument(e,t))}n.be&&(e.set(i,n.Ce()),n.ve())}}));let n=nu();this.qe.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const i=new Gu(t,e,this.Qe,this.ke,n);return this.ke=Gc(),this.qe=tl(),this.Qe=new Ca(ia),i}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Ju,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new ka(ia),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||Fo("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Ju),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function tl(){return new Ca(ha.comparator)}function el(){return new Ca(ha.comparator)}const nl={asc:"ASCENDING",desc:"DESCENDING"},il={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rl={and:"AND",or:"OR"};class sl{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ol(t,e){return t.useProto3Json||Ea(e)?e:{value:e}}function al(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cl(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ul(t,e){return al(t,e.toTimestamp())}function ll(t){return zo(!!t),oa.fromTimestamp(function(t){const e=Oa(t);return new sa(e.seconds,e.nanos)}(t))}function hl(t,e){return dl(t,e).canonicalString()}function dl(t,e){const n=function(t){return new ca(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function fl(t){const e=ca.fromString(t);return zo(xl(e)),e}function pl(t,e){return hl(t.databaseId,e.path)}function gl(t,e){const n=fl(e);if(n.get(1)!==t.databaseId.projectId)throw new Ko($o.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ko($o.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ha(vl(n))}function ml(t,e){return hl(t.databaseId,e)}function yl(t){return new ca(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function vl(t){return zo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function wl(t,e,n){return{name:pl(t,e),fields:n.value.mapValue.fields}}function bl(t,e){return{documents:[ml(t,e.path)]}}function El(t,e){const n={structuredQuery:{}},i=e.path;let r;null!==e.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=ml(t,r);const s=function(t){if(0!==t.length)return kl(pc.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Al(t.field),direction:Il(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ol(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:r}}function Tl(t){let e=function(t){const e=fl(t);return 4===e.length?ca.emptyPath():vl(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){zo(1===i);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=_l(t);return e instanceof pc&&mc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new lc(Dl(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ea(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ac(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ac(n,e)}(n.endAt)),function(t,e,n,i,r,s,o,a){return new Lc(t,e,n,i,r,s,o,a)}(e,r,o,s,a,"F",c,u)}function _l(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Dl(t.unaryFilter.field);return fc.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Dl(t.unaryFilter.field);return fc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Dl(t.unaryFilter.field);return fc.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Dl(t.unaryFilter.field);return fc.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Bo()}}(t):void 0!==t.fieldFilter?function(t){return fc.create(Dl(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Bo()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return pc.create(t.compositeFilter.filters.map((t=>_l(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Bo()}}(t.compositeFilter.op))}(t):Bo()}function Il(t){return nl[t]}function Sl(t){return il[t]}function Cl(t){return rl[t]}function Al(t){return{fieldPath:t.canonicalString()}}function Dl(t){return la.fromServerFormat(t.fieldPath)}function kl(t){return t instanceof fc?function(t){if("=="===t.op){if(tc(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NAN"}};if(Za(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(tc(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NOT_NAN"}};if(Za(t.value))return{unaryFilter:{field:Al(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Al(t.field),op:Sl(t.op),value:t.value}}}(t):t instanceof pc?function(t){const e=t.getFilters().map((t=>kl(t)));return 1===e.length?e[0]:{compositeFilter:{op:Cl(t.op),filters:e}}}(t):Bo()}function Nl(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function xl(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Rl{constructor(t,e,n,i,r=oa.min(),s=oa.min(),o=La.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Rl(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Rl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ll{constructor(t){this.ut=t}}function Ml(t){const e=Tl({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Vc(e,e.limit,"L"):e}class Ol{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(Pa(t.integerValue));else if("doubleValue"in t){const n=Pa(t.doubleValue);isNaN(n)?this.Tt(e,13):(this.Tt(e,15),Ta(n)?e.Et(0):e.Et(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Tt(e,20),"string"==typeof n&&(n=Oa(n)),e.dt(`${n.seconds||""}`),e.Et(n.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(Fa(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Tt(e,45),e.Et(n.latitude||0),e.Et(n.longitude||0)}else"mapValue"in t?ic(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):Bo()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){const n=t.fields||{};this.Tt(e,55);for(const t of Object.keys(n))this.At(t,e),this.Pt(n[t],e)}yt(t,e){const n=t.values||[];this.Tt(e,50);for(const t of n)this.Pt(t,e)}ft(t,e){this.Tt(e,37),ha.fromName(t).path.forEach((t=>{this.Tt(e,60),this.wt(t,e)}))}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}}Ol.St=new Ol;class Pl{constructor(){this.on=new Fl}addToCollectionParentIndex(t,e){return this.on.add(e),va.resolve()}getCollectionParents(t,e){return va.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return va.resolve()}deleteFieldIndex(t,e){return va.resolve()}deleteAllFieldIndexes(t){return va.resolve()}createTargetIndexes(t,e){return va.resolve()}getDocumentsMatchingTarget(t,e){return va.resolve(null)}getIndexType(t,e){return va.resolve(0)}getFieldIndexes(t,e){return va.resolve([])}getNextCollectionGroupToUpdate(t){return va.resolve(null)}getMinOffset(t,e){return va.resolve(fa.min())}getMinOffsetFromCollectionGroup(t,e){return va.resolve(fa.min())}updateCollectionGroup(t,e,n){return va.resolve()}updateIndexEntries(t,e){return va.resolve()}}class Fl{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new ka(ca.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new ka(ca.comparator)).toArray()}}new Uint8Array(0);class Vl{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Vl(t,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Vl.DEFAULT_COLLECTION_PERCENTILE=10,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vl.DEFAULT=new Vl(41943040,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vl.DISABLED=new Vl(-1,0,0);class ql{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new ql(0)}static Nn(){return new ql(-1)}}class Ul{constructor(){this.changes=new Kc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,oc.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?va.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Bl{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class zl{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Su(n.mutation,t,xa.empty(),sa.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,nu()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=nu()){const i=Yc();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Wc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Yc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,nu())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let r=Gc();const s=Zc(),o=Zc();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof ku)?r=r.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Su(o.mutation,e,o.mutation.getFieldMask(),sa.now())):s.set(e.key,xa.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Bl(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Zc();let i=new Ca(((t,e)=>t-e)),r=nu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||xa.empty();o=r.applyToLocalView(s,o),n.set(t,o);const a=(i.get(r.batchId)||nu()).add(t);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=Jc();c.forEach((t=>{if(!r.has(t)){const i=_u(e.get(t),n.get(t));null!==i&&u.set(t,i),r=r.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return va.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,i){return function(t){return ha.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):va.resolve(Yc());let o=-1,a=r;return s.next((e=>va.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?va.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,nu()))).next((t=>({batchId:o,changes:Xc(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ha(e)).next((t=>{let e=Wc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){const r=e.collectionGroup;let s=Wc();return this.indexManager.getCollectionParents(t,r).next((o=>va.forEach(o,(o=>{const a=function(t,e){return new Lc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(r));return this.getDocumentsMatchingCollectionQuery(t,a,n,i).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r,i)))).next((t=>{r.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,oc.newInvalidDocument(i)))}));let n=Wc();return t.forEach(((t,i)=>{const s=r.get(t);void 0!==s&&Su(s.mutation,i,xa.empty(),sa.now()),zc(e,i)&&(n=n.insert(t,i))})),n}))}}class jl{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return va.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ll(t.createTime)}}(e)),va.resolve()}getNamedQuery(t,e){return va.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(t){return{name:t.name,query:Ml(t.bundledQuery),readTime:ll(t.readTime)}}(e)),va.resolve()}}class $l{constructor(){this.overlays=new Ca(ha.comparator),this.lr=new Map}getOverlay(t,e){return va.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Yc();return va.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.lt(t,e,i)})),va.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.lr.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.lr.delete(n)),va.resolve()}getOverlaysForCollection(t,e,n){const i=Yc(),r=e.length+1,s=new ha(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return va.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new Ca(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=Yc(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Yc(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return va.resolve(o)}lt(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.lr.get(i.largestBatchId).delete(n.key);this.lr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Fu(e,n));let r=this.lr.get(e);void 0===r&&(r=nu(),this.lr.set(e,r)),this.lr.set(e,r.add(n.key))}}class Kl{constructor(){this.hr=new ka(Hl.Pr),this.Ir=new ka(Hl.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){const n=new Hl(t,e);this.hr=this.hr.add(n),this.Ir=this.Ir.add(n)}Er(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.dr(new Hl(t,e))}Ar(t,e){t.forEach((t=>this.removeReference(t,e)))}Rr(t){const e=new ha(new ca([])),n=new Hl(e,t),i=new Hl(e,t+1),r=[];return this.Ir.forEachInRange([n,i],(t=>{this.dr(t),r.push(t.key)})),r}Vr(){this.hr.forEach((t=>this.dr(t)))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){const e=new ha(new ca([])),n=new Hl(e,t),i=new Hl(e,t+1);let r=nu();return this.Ir.forEachInRange([n,i],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Hl(t,0),n=this.hr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Hl{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return ha.comparator(t.key,e.key)||ia(t.gr,e.gr)}static Tr(t,e){return ia(t.gr,e.gr)||ha.comparator(t.key,e.key)}}class Gl{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new ka(Hl.Pr)}checkEmpty(t){return va.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ou(r,e,n,i);this.mutationQueue.push(s);for(const e of i)this.yr=this.yr.add(new Hl(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return va.resolve(s)}lookupMutationBatch(t,e){return va.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.Sr(n),r=i<0?0:i;return va.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return va.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(t){return va.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Hl(e,0),i=new Hl(e,Number.POSITIVE_INFINITY),r=[];return this.yr.forEachInRange([n,i],(t=>{const e=this.wr(t.gr);r.push(e)})),va.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ka(ia);return e.forEach((t=>{const e=new Hl(t,0),i=new Hl(t,Number.POSITIVE_INFINITY);this.yr.forEachInRange([e,i],(t=>{n=n.add(t.gr)}))})),va.resolve(this.br(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;ha.isDocumentKey(r)||(r=r.child(""));const s=new Hl(new ha(r),0);let o=new ka(ia);return this.yr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.gr)),!0)}),s),va.resolve(this.br(o))}br(t){const e=[];return t.forEach((t=>{const n=this.wr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){zo(0===this.Dr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.yr;return va.forEach(e.mutations,(i=>{const r=new Hl(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.yr=n}))}Fn(t){}containsKey(t,e){const n=new Hl(e,0),i=this.yr.firstAfterOrEqual(n);return va.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,va.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}wr(t){const e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Ql{constructor(t){this.Cr=t,this.docs=new Ca(ha.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,s=this.Cr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return va.resolve(n?n.document.mutableCopy():oc.newInvalidDocument(e))}getEntries(t,e){let n=Gc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():oc.newInvalidDocument(t))})),va.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Gc();const s=e.path,o=new ha(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||pa(da(o),n)<=0||(i.has(o.key)||zc(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return va.resolve(r)}getAllFromCollectionGroup(t,e,n,i){Bo()}vr(t,e){return va.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Wl(this)}getSize(t){return va.resolve(this.size)}}class Wl extends Ul{constructor(t){super(),this._r=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this._r.addEntry(t,i)):this._r.removeEntry(n)})),va.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}}class Xl{constructor(t){this.persistence=t,this.Fr=new Kc((t=>Nc(t)),xc),this.lastRemoteSnapshotVersion=oa.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Kl,this.targetCount=0,this.Nr=ql.On()}forEachTarget(t,e){return this.Fr.forEach(((t,n)=>e(n))),va.resolve()}getLastRemoteSnapshotVersion(t){return va.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return va.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),va.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Mr&&(this.Mr=e),va.resolve()}kn(t){this.Fr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Nr=new ql(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,va.resolve()}updateTargetData(t,e){return this.kn(e),va.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,va.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.Fr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fr.delete(s),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),va.waitFor(r).next((()=>i))}getTargetCount(t){return va.resolve(this.targetCount)}getTargetData(t,e){const n=this.Fr.get(e)||null;return va.resolve(n)}addMatchingKeys(t,e,n){return this.Or.Er(e,n),va.resolve()}removeMatchingKeys(t,e,n){this.Or.Ar(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach((e=>{r.push(i.markPotentiallyOrphaned(t,e))})),va.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),va.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Or.mr(e);return va.resolve(n)}containsKey(t,e){return va.resolve(this.Or.containsKey(e))}}class Yl{constructor(t,e){this.Lr={},this.overlays={},this.Br=new ba(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new Xl(this),this.indexManager=new Pl,this.remoteDocumentCache=function(t){return new Ql(t)}((t=>this.referenceDelegate.Qr(t))),this.serializer=new Ll(e),this.Kr=new jl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new $l,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new Gl(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,n){Fo("MemoryPersistence","Starting transaction:",t);const i=new Jl(this.Br.next());return this.referenceDelegate.$r(),n(i).next((t=>this.referenceDelegate.Ur(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Wr(t,e){return va.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class Jl extends ma{constructor(t){super(),this.currentSequenceNumber=t}}class Zl{constructor(t){this.persistence=t,this.Gr=new Kl,this.zr=null}static jr(t){return new Zl(t)}get Hr(){if(this.zr)return this.zr;throw Bo()}addReference(t,e,n){return this.Gr.addReference(n,e),this.Hr.delete(n.toString()),va.resolve()}removeReference(t,e,n){return this.Gr.removeReference(n,e),this.Hr.add(n.toString()),va.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),va.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach((t=>this.Hr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Hr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}$r(){this.zr=new Set}Ur(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return va.forEach(this.Hr,(n=>{const i=ha.fromPath(n);return this.Jr(t,i).next((t=>{t||e.removeEntry(i,oa.min())}))})).next((()=>(this.zr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Jr(t,e).next((t=>{t?this.Hr.delete(e.toString()):this.Hr.add(e.toString())}))}Qr(t){return 0}Jr(t,e){return va.or([()=>va.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}}class th{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.ki=n,this.qi=i}static Qi(t,e){let n=nu(),i=nu();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new th(t,e.fromCache,n,i)}}class eh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class nh{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,n,i){const r={result:null};return this.zi(t,e).next((t=>{r.result=t})).next((()=>{if(!r.result)return this.ji(t,e,i,n).next((t=>{r.result=t}))})).next((()=>{if(r.result)return;const n=new eh;return this.Hi(t,e,n).next((i=>{if(r.result=i,this.$i)return this.Ji(t,e,n,i.size)}))})).next((()=>r.result))}Ji(t,e,n,i){return n.documentReadCount<this.Ui?(Po()<=C.DEBUG&&Fo("QueryEngine","SDK will not create cache indexes for query:",Bc(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),va.resolve()):(Po()<=C.DEBUG&&Fo("QueryEngine","Query:",Bc(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Wi*i?(Po()<=C.DEBUG&&Fo("QueryEngine","The SDK decides to create cache indexes for query:",Bc(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Fc(e))):va.resolve())}zi(t,e){if(Oc(e))return va.resolve(null);let n=Fc(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=Vc(e,null,"F"),n=Fc(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const r=nu(...i);return this.Gi.getDocuments(t,r).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Yi(e,i);return this.Zi(e,s,r,n.readTime)?this.zi(t,Vc(e,null,"F")):this.Xi(t,s,e,n)}))))})))))}ji(t,e,n,i){return Oc(e)||i.isEqual(oa.min())?va.resolve(null):this.Gi.getDocuments(t,n).next((r=>{const s=this.Yi(e,r);return this.Zi(e,s,n,i)?va.resolve(null):(Po()<=C.DEBUG&&Fo("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Bc(e)),this.Xi(t,s,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=oa.fromTimestamp(1e9===i?new sa(n+1,0):new sa(n,i));return new fa(r,ha.empty(),e)}(i,-1)).next((t=>t)))}))}Yi(t,e){let n=new ka(jc(t));return e.forEach(((e,i)=>{zc(t,i)&&(n=n.add(i))})),n}Zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Hi(t,e,n){return Po()<=C.DEBUG&&Fo("QueryEngine","Using full collection scan to execute query:",Bc(e)),this.Gi.getDocumentsMatchingQuery(t,e,fa.min(),n)}Xi(t,e,n,i){return this.Gi.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ih{constructor(t,e,n,i){this.persistence=t,this.es=e,this.serializer=i,this.ts=new Ca(ia),this.ns=new Kc((t=>Nc(t)),xc),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(n)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new zl(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ts)))}}async function rh(t,e){const n=jo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((r=>(i=r,n.os(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],s=[];let o=nu();for(const t of i){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({_s:t,removedBatchIds:r,addedBatchIds:s})))}))}))}function sh(t){const e=jo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.qr.getLastRemoteSnapshotVersion(t)))}function oh(t,e){const n=jo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function ah(t,e,n){const i=jo(t),r=i.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(t=>i.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!wa(t))throw t;Fo("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.ts=i.ts.remove(e),i.ns.delete(r.target)}function ch(t,e,n){const i=jo(t);let r=oa.min(),s=nu();return i.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const i=jo(t),r=i.ns.get(n);return void 0!==r?va.resolve(i.ts.get(r)):i.qr.getTargetData(e,n)}(i,t,Fc(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,i.qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>i.es.getDocumentsMatchingQuery(t,e,n?r:oa.min(),n?s:nu()))).next((t=>(function(t,e,n){let i=t.rs.get(e)||oa.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.rs.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ls:s})))))}class uh{constructor(){this.activeTargetIds=iu}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class lh{constructor(){this.eo=new uh,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,n){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new uh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class hh{ro(t){}shutdown(){}}class dh{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){Fo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ao)t(0)}_o(){Fo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ao)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fh=null;function ph(){return null===fh?fh=268435456+Math.round(2147483648*Math.random()):fh++,"0x"+fh.toString(16)}const gh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class mh{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}Eo(t){this.Ao=t}onMessage(t){this.Ro=t}close(){this.lo()}send(t){this.co(t)}Vo(){this.Po()}mo(){this.To()}fo(t){this.Ao(t)}po(t){this.Ro(t)}}const yh="WebChannelConnection";class vh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.yo=e+"://"+t.host,this.wo=`projects/${n}/databases/${i}`,this.So="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get bo(){return!1}Do(t,e,n,i,r){const s=ph(),o=this.Co(t,e.toUriEncodedString());Fo("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(a,i,r),this.Fo(t,o,a,n).then((e=>(Fo("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw qo("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Mo(t,e,n,i,r,s){return this.Do(t,e,n,i,r)}vo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Mo,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}Co(t,e){const n=gh[t];return`${this.yo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Fo(t,e,n,i){const r=ph();return new Promise(((s,o)=>{const a=new ko;a.setWithCredentials(!0),a.listenOnce(Io.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case _o.NO_ERROR:const e=a.getResponseJson();Fo(yh,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),s(e);break;case _o.TIMEOUT:Fo(yh,`RPC '${t}' ${r} timed out`),o(new Ko($o.DEADLINE_EXCEEDED,"Request time out"));break;case _o.HTTP_ERROR:const n=a.getStatus();if(Fo(yh,`RPC '${t}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values($o).indexOf(e)>=0?e:$o.UNKNOWN}(e.status);o(new Ko(t,e.message))}else o(new Ko($o.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ko($o.UNAVAILABLE,"Connection failed."));break;default:Bo()}}finally{Fo(yh,`RPC '${t}' ${r} completed.`)}}));const c=JSON.stringify(i);Fo(yh,`RPC '${t}' ${r} sending request:`,i),a.send(e,"POST",c,n,15)}))}xo(t,e,n){const i=ph(),r=[this.yo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Eo(),o=To(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Ao({})),this.vo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=r.join("");Fo(yh,`Creating RPC '${t}' stream ${i}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new mh({co:e=>{d?Fo(yh,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(h||(Fo(yh,`Opening RPC '${t}' stream ${i} transport.`),l.open(),h=!0),Fo(yh,`RPC '${t}' stream ${i} sending:`,e),l.send(e))},lo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,Do.EventType.OPEN,(()=>{d||(Fo(yh,`RPC '${t}' stream ${i} transport opened.`),f.Vo())})),p(l,Do.EventType.CLOSE,(()=>{d||(d=!0,Fo(yh,`RPC '${t}' stream ${i} transport closed`),f.fo())})),p(l,Do.EventType.ERROR,(e=>{d||(d=!0,qo(yh,`RPC '${t}' stream ${i} transport errored:`,e),f.fo(new Ko($o.UNAVAILABLE,"The operation could not be completed")))})),p(l,Do.EventType.MESSAGE,(e=>{var n;if(!d){const r=e.data[0];zo(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Fo(yh,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=qu[t];if(void 0!==e)return Bu(e)}(e),r=o.message;void 0===n&&(n=$o.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.fo(new Ko(n,r)),l.close()}else Fo(yh,`RPC '${t}' stream ${i} received:`,r),f.po(r)}})),p(o,So.STAT_EVENT,(e=>{e.stat===Co.PROXY?Fo(yh,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Co.NOPROXY&&Fo(yh,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.mo()}),0),f}}function wh(){return"undefined"!=typeof document?document:null}function bh(t){return new sl(t,!0)}class Eh{constructor(t,e,n=1e3,i=1.5,r=6e4){this.si=t,this.timerId=e,this.Oo=n,this.No=i,this.Lo=r,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();const e=Math.floor(this.Bo+this.$o()),n=Math.max(0,Date.now()-this.qo),i=Math.max(0,e-n);i>0&&Fo("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,(()=>(this.qo=Date.now(),t()))),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class Th{constructor(t,e,n,i,r,s,o,a){this.si=t,this.Wo=n,this.Go=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Eh(t,e)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}async stop(){this.Yo()&&await this.close(0)}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,(()=>this.n_())))}r_(t){this.i_(),this.stream.send(t)}async n_(){if(this.Zo())return this.close(0)}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}async close(t,e){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,4!==t?this.Jo.reset():e&&e.code===$o.RESOURCE_EXHAUSTED?(Vo(e.toString()),Vo("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):e&&e.code===$o.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.o_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Eo(e)}o_(){}auth(){this.state=1;const t=this.__(this.zo),e=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.zo===e&&this.a_(t,n)}),(e=>{t((()=>{const t=new Ko($o.UNKNOWN,"Fetching auth token failed: "+e.message);return this.u_(t)}))}))}a_(t,e){const n=this.__(this.zo);this.stream=this.c_(t,e),this.stream.ho((()=>{n((()=>this.listener.ho()))})),this.stream.Io((()=>{n((()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,(()=>(this.Zo()&&(this.state=3),Promise.resolve()))),this.listener.Io())))})),this.stream.Eo((t=>{n((()=>this.u_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Xo(){this.state=5,this.Jo.Ko((async()=>{this.state=0,this.start()}))}u_(t){return Fo("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}__(t){return e=>{this.si.enqueueAndForget((()=>this.zo===t?e():(Fo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _h extends Th{constructor(t,e,n,i,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r}c_(t,e){return this.connection.xo("Listen",t,e)}onMessage(t){this.Jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Bo()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(zo(void 0===e||"string"==typeof e),La.fromBase64String(e||"")):(zo(void 0===e||e instanceof Buffer||e instanceof Uint8Array),La.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?$o.UNKNOWN:Bu(t.code);return new Ko(e,t.message||"")}(o);n=new Yu(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=gl(t,i.document.name),s=ll(i.document.updateTime),o=i.document.createTime?ll(i.document.createTime):oa.min(),a=new rc({mapValue:{fields:i.document.fields}}),c=oc.newFoundDocument(r,s,o,a),u=i.targetIds||[],l=i.removedTargetIds||[];n=new Wu(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=gl(t,i.document),s=i.readTime?ll(i.readTime):oa.min(),o=oc.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Wu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=gl(t,i.document),s=i.removedTargetIds||[];n=new Wu([],s,r,null)}else{if(!("filter"in e))return Bo();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:r}=t,s=new Vu(i,r),o=t.targetId;n=new Xu(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return oa.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?oa.min():e.readTime?ll(e.readTime):oa.min()}(t);return this.listener.l_(e,n)}h_(t){const e={};e.database=yl(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=Rc(i)?{documents:bl(t,i)}:{query:El(t,i)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=cl(t,e.resumeToken);const i=ol(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(oa.min())>0){n.readTime=al(t,e.snapshotVersion.toTimestamp());const i=ol(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Bo()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.r_(e)}P_(t){const e={};e.database=yl(this.serializer),e.removeTarget=t,this.r_(e)}}class Ih extends Th{constructor(t,e,n,i,r,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(t,e){return this.connection.xo("Write",t,e)}onMessage(t){if(zo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.I_){this.Jo.reset();const e=function(t,e){return t&&t.length>0?(zo(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?ll(t.updateTime):ll(e);return n.isEqual(oa.min())&&(n=ll(e)),new wu(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=ll(t.commitTime);return this.listener.d_(n,e)}return zo(!t.writeResults||0===t.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const t={};t.database=yl(this.serializer),this.r_(t)}E_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Du)n={update:wl(t,e.key,e.value)};else if(e instanceof Lu)n={delete:pl(t,e.key)};else if(e instanceof ku)n={update:wl(t,e.key,e.data),updateMask:Nl(e.fieldMask)};else{if(!(e instanceof Mu))return Bo();n={verify:pl(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof hu)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof du)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof pu)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof mu)return{fieldPath:e.field.canonicalString(),increment:n.Pe};throw Bo()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ul(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Bo()}(t,e.precondition)),n}(this.serializer,t)))};this.r_(e)}}class Sh extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new Ko($o.FAILED_PRECONDITION,"The client has already been terminated.")}Do(t,e,n,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.Do(t,dl(e,n),i,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===$o.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko($o.UNKNOWN,t.toString())}))}Mo(t,e,n,i,r){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Mo(t,dl(e,n),i,s,o,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===$o.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko($o.UNKNOWN,t.toString())}))}terminate(){this.V_=!0,this.connection.terminate()}}class Ch{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(t){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Vo(e),this.y_=!1):Fo("OnlineStateTracker",e)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Ah{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=r,this.O_.ro((t=>{n.enqueueAndForget((async()=>{Ph(this)&&(Fo("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=jo(t);e.M_.add(4),await kh(e),e.N_.set("Unknown"),e.M_.delete(4),await Dh(e)}(this))}))})),this.N_=new Ch(n,i)}}async function Dh(t){if(Ph(t))for(const e of t.x_)await e(!0)}async function kh(t){for(const e of t.x_)await e(!1)}function Nh(t,e){const n=jo(t);n.F_.has(e.targetId)||(n.F_.set(e.targetId,e),Oh(n)?Mh(n):td(n).Zo()&&Rh(n,e))}function xh(t,e){const n=jo(t),i=td(n);n.F_.delete(e),i.Zo()&&Lh(n,e),0===n.F_.size&&(i.Zo()?i.t_():Ph(n)&&n.N_.set("Unknown"))}function Rh(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(oa.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}td(t).h_(e)}function Lh(t,e){t.L_.xe(e),td(t).P_(e)}function Mh(t){t.L_=new Zu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),td(t).start(),t.N_.w_()}function Oh(t){return Ph(t)&&!td(t).Yo()&&t.F_.size>0}function Ph(t){return 0===jo(t).M_.size}function Fh(t){t.L_=void 0}async function Vh(t){t.N_.set("Online")}async function qh(t){t.F_.forEach(((e,n)=>{Rh(t,e)}))}async function Uh(t,e){Fh(t),Oh(t)?(t.N_.D_(e),Mh(t)):t.N_.set("Unknown")}async function Bh(t,e,n){if(t.N_.set("Online"),e instanceof Yu&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.F_.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.F_.delete(i),t.L_.removeTarget(i))}(t,e)}catch(n){Fo("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await zh(t,n)}else if(e instanceof Wu?t.L_.Ke(e):e instanceof Xu?t.L_.He(e):t.L_.We(e),!n.isEqual(oa.min()))try{const e=await sh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.L_.rt(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.F_.get(i);r&&t.F_.set(i,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.F_.get(e);if(!i)return;t.F_.set(e,i.withResumeToken(La.EMPTY_BYTE_STRING,i.snapshotVersion)),Lh(t,e);const r=new Rl(i.target,e,n,i.sequenceNumber);Rh(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Fo("RemoteStore","Failed to raise snapshot:",e),await zh(t,e)}}async function zh(t,e,n){if(!wa(e))throw e;t.M_.add(1),await kh(t),t.N_.set("Offline"),n||(n=()=>sh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Fo("RemoteStore","Retrying IndexedDB access"),await n(),t.M_.delete(1),await Dh(t)}))}function jh(t,e){return e().catch((n=>zh(t,n,e)))}async function $h(t){const e=jo(t),n=ed(e);let i=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Kh(e);)try{const t=await oh(e.localStore,i);if(null===t){0===e.v_.length&&n.t_();break}i=t.batchId,Hh(e,t)}catch(t){await zh(e,t)}Gh(e)&&Qh(e)}function Kh(t){return Ph(t)&&t.v_.length<10}function Hh(t,e){t.v_.push(e);const n=ed(t);n.Zo()&&n.T_&&n.E_(e.mutations)}function Gh(t){return Ph(t)&&!ed(t).Yo()&&t.v_.length>0}function Qh(t){ed(t).start()}async function Wh(t){ed(t).R_()}async function Xh(t){const e=ed(t);for(const n of t.v_)e.E_(n.mutations)}async function Yh(t,e,n){const i=t.v_.shift(),r=Pu.from(i,e,n);await jh(t,(()=>t.remoteSyncer.applySuccessfulWrite(r))),await $h(t)}async function Jh(t,e){e&&ed(t).T_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return Bo();case $o.CANCELLED:case $o.UNKNOWN:case $o.DEADLINE_EXCEEDED:case $o.RESOURCE_EXHAUSTED:case $o.INTERNAL:case $o.UNAVAILABLE:case $o.UNAUTHENTICATED:return!1;case $o.INVALID_ARGUMENT:case $o.NOT_FOUND:case $o.ALREADY_EXISTS:case $o.PERMISSION_DENIED:case $o.FAILED_PRECONDITION:case $o.ABORTED:case $o.OUT_OF_RANGE:case $o.UNIMPLEMENTED:case $o.DATA_LOSS:return!0}}(t)&&t!==$o.ABORTED}(e.code)){const n=t.v_.shift();ed(t).e_(),await jh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await $h(t)}}(t,e),Gh(t)&&Qh(t)}async function Zh(t,e){const n=jo(t);n.asyncQueue.verifyOperationInProgress(),Fo("RemoteStore","RemoteStore received new credentials");const i=Ph(n);n.M_.add(3),await kh(n),i&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.M_.delete(3),await Dh(n)}function td(t){return t.B_||(t.B_=function(t,e,n){const i=jo(t);return i.m_(),new _h(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{ho:Vh.bind(null,t),Io:qh.bind(null,t),Eo:Uh.bind(null,t),l_:Bh.bind(null,t)}),t.x_.push((async e=>{e?(t.B_.e_(),Oh(t)?Mh(t):t.N_.set("Unknown")):(await t.B_.stop(),Fh(t))}))),t.B_}function ed(t){return t.k_||(t.k_=function(t,e,n){const i=jo(t);return i.m_(),new Ih(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{ho:()=>Promise.resolve(),Io:Wh.bind(null,t),Eo:Jh.bind(null,t),A_:Xh.bind(null,t),d_:Yh.bind(null,t)}),t.x_.push((async e=>{e?(t.k_.e_(),await $h(t)):(await t.k_.stop(),t.v_.length>0&&(Fo("RemoteStore",`Stopping write stream with ${t.v_.length} pending writes`),t.v_=[]))}))),t.k_}class nd{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Ho,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,r){const s=Date.now()+n,o=new nd(t,e,s,i,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ko($o.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function id(t,e){if(Vo("AsyncQueue",`${e}: ${t}`),wa(t))return new Ko($o.UNAVAILABLE,`${e}: ${t}`);throw t}class rd{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ha.comparator(e.key,n.key):(t,e)=>ha.comparator(t.key,e.key),this.keyedMap=Wc(),this.sortedSet=new Ca(this.comparator)}static emptySet(t){return new rd(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof rd))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new rd;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class sd{constructor(){this.q_=new Ca(ha.comparator)}track(t){const e=t.doc.key,n=this.q_.get(e);n?0!==t.type&&3===n.type?this.q_=this.q_.insert(e,t):3===t.type&&1!==n.type?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.q_=this.q_.remove(e):1===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):Bo():this.q_=this.q_.insert(e,t)}Q_(){const t=[];return this.q_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class od{constructor(t,e,n,i,r,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new od(t,e,rd.emptySet(e),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ad{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((t=>t.G_()))}}class cd{constructor(){this.queries=new Kc((t=>Uc(t)),qc),this.onlineState="Unknown",this.z_=new Set}}function ud(t,e){const n=jo(t);let i=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.U_)e.H_(t)&&(i=!0);r.K_=t}}i&&hd(n)}function ld(t,e,n){const i=jo(t),r=i.queries.get(e);if(r)for(const t of r.U_)t.onError(n);i.queries.delete(e)}function hd(t){t.z_.forEach((t=>{t.next()}))}var dd,fd;(fd=dd||(dd={})).J_="default",fd.Cache="cache";class pd{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new od(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==e;return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ea(t){if(t.docChanges.length>0)return!0;const e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}na(t){t=od.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==dd.Cache}}class gd{constructor(t){this.key=t}}class md{constructor(t){this.key=t}}class yd{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=nu(),this.mutatedKeys=nu(),this.Ia=jc(t),this.Ta=new rd(this.Ia)}get Ea(){return this.la}da(t,e){const n=e?e.Aa:new sd,i=e?e.Ta:this.Ta;let r=e?e.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),l=zc(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Ra(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Ia(l,a)>0||c&&this.Ia(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),r=d?r.add(t):r.delete(t)):(s=s.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{Ta:s,Aa:n,Zi:o,mutatedKeys:r}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){const r=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;const s=t.Aa.Q_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Bo()}};return n(t)-n(e)}(t.type,e.type)||this.Ia(t.doc,e.doc))),this.Va(n),i=null!=i&&i;const o=e&&!i?this.ma():[],a=0===this.Pa.size&&this.current&&!i?1:0,c=a!==this.ha;return this.ha=a,0!==s.length||c?{snapshot:new od(this.query,t.Ta,r,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new sd,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach((t=>this.la=this.la.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.la=this.la.delete(t))),this.current=t.current)}ma(){if(!this.current)return[];const t=this.Pa;this.Pa=nu(),this.Ta.forEach((t=>{this.ga(t.key)&&(this.Pa=this.Pa.add(t.key))}));const e=[];return t.forEach((t=>{this.Pa.has(t)||e.push(new md(t))})),this.Pa.forEach((n=>{t.has(n)||e.push(new gd(n))})),e}pa(t){this.la=t.ls,this.Pa=nu();const e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return od.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class vd{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class wd{constructor(t){this.key=t,this.wa=!1}}class bd{constructor(t,e,n,i,r,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new Kc((t=>Uc(t)),qc),this.Da=new Map,this.Ca=new Set,this.va=new Ca(ha.comparator),this.Fa=new Map,this.Ma=new Kl,this.xa={},this.Oa=new Map,this.Na=ql.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function Ed(t,e,n=!0){const i=Bd(t);let r;const s=i.ba.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ya()):r=await _d(i,e,n,!0),r}async function Td(t,e){const n=Bd(t);await _d(n,e,!0,!1)}async function _d(t,e,n,i){const r=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.qr.getTargetData(t,e).next((r=>r?(i=r,va.resolve(i)):n.qr.allocateTargetId(t).next((r=>(i=new Rl(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.qr.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.ts.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ts=n.ts.insert(t.targetId,t),n.ns.set(e,t.targetId)),t}))}(t.localStore,Fc(e)),s=r.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return i&&(a=await async function(t,e,n,i,r){t.Ba=(e,n,i)=>async function(t,e,n,i){let r=e.view.da(n);r.Zi&&(r=await ch(t.localStore,e.query,!1).then((({documents:t})=>e.view.da(t,r))));const s=i&&i.targetChanges.get(e.targetId),o=i&&null!=i.targetMismatches.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,s,o);return Od(t,e.targetId,a.fa),a.snapshot}(t,e,n,i);const s=await ch(t.localStore,e,!0),o=new yd(e,s.ls),a=o.da(s.documents),c=Qu.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,r),u=o.applyChanges(a,t.isPrimaryClient,c);Od(t,n,u.fa);const l=new vd(e,n,o);return t.ba.set(e,l),t.Da.has(n)?t.Da.get(n).push(e):t.Da.set(n,[e]),u.snapshot}(t,e,s,"current"===o,r.resumeToken)),t.isPrimaryClient&&n&&Nh(t.remoteStore,r),a}async function Id(t,e,n){const i=jo(t),r=i.ba.get(e),s=i.Da.get(r.targetId);if(s.length>1)return i.Da.set(r.targetId,s.filter((t=>!qc(t,e)))),void i.ba.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await ah(i.localStore,r.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(r.targetId),n&&xh(i.remoteStore,r.targetId),Ld(i,r.targetId)})).catch(ya)):(Ld(i,r.targetId),await ah(i.localStore,r.targetId,!0))}async function Sd(t,e){const n=jo(t),i=n.ba.get(e),r=n.Da.get(i.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),xh(n.remoteStore,i.targetId))}async function Cd(t,e){const n=jo(t);try{const t=await function(t,e){const n=jo(t),i=e.snapshotVersion;let r=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.ss.newChangeBuffer({trackRemovals:!0});r=n.ts;const o=[];e.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.qr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(La.EMPTY_BYTE_STRING,oa.min()).withLastLimboFreeSnapshotVersion(oa.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,i)),r=r.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.qr.updateTargetData(t,u))}));let a=Gc(),c=nu();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=nu(),r=nu();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Gc();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(oa.min())?(e.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),i=i.insert(n,s)):Fo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{us:i,cs:r}}))}(t,s,e.documentUpdates).next((t=>{a=t.us,c=t.cs}))),!i.isEqual(oa.min())){const e=n.qr.getLastRemoteSnapshotVersion(t).next((e=>n.qr.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return va.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ts=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.Fa.get(e);i&&(zo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.wa=!0:t.modifiedDocuments.size>0?zo(i.wa):t.removedDocuments.size>0&&(zo(i.wa),i.wa=!1))})),await Vd(n,t,e)}catch(t){await ya(t)}}function Ad(t,e,n){const i=jo(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.ba.forEach(((n,i)=>{const r=i.view.j_(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=jo(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.U_)t.j_(e)&&(i=!0)})),i&&hd(n)}(i.eventManager,e),t.length&&i.Sa.l_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Dd(t,e,n){const i=jo(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.Fa.get(e),s=r&&r.key;if(s){let t=new Ca(ha.comparator);t=t.insert(s,oc.newNoDocument(s,oa.min()));const n=nu().add(s),r=new Gu(oa.min(),new Map,new Ca(ia),t,n);await Cd(i,r),i.va=i.va.remove(s),i.Fa.delete(e),Fd(i)}else await ah(i.localStore,e,!1).then((()=>Ld(i,e,n))).catch(ya)}async function kd(t,e){const n=jo(t),i=e.batch.batchId;try{const t=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),r=n.ss.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const r=n.batch,s=r.keys();let o=va.resolve();return s.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);zo(null!==s),e.version.compareTo(s)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,r)))}(n,t,e,r).next((()=>r.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=nu();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);Rd(n,i,null),xd(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Vd(n,t)}catch(t){await ya(t)}}async function Nd(t,e,n){const i=jo(t);try{const t=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(zo(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);Rd(i,e,n),xd(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Vd(i,t)}catch(n){await ya(n)}}function xd(t,e){(t.Oa.get(e)||[]).forEach((t=>{t.resolve()})),t.Oa.delete(e)}function Rd(t,e,n){const i=jo(t);let r=i.xa[i.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),i.xa[i.currentUser.toKey()]=r}}function Ld(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.Da.get(e))t.ba.delete(i),n&&t.Sa.ka(i,n);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Rr(e).forEach((e=>{t.Ma.containsKey(e)||Md(t,e)}))}function Md(t,e){t.Ca.delete(e.path.canonicalString());const n=t.va.get(e);null!==n&&(xh(t.remoteStore,n),t.va=t.va.remove(e),t.Fa.delete(n),Fd(t))}function Od(t,e,n){for(const i of n)i instanceof gd?(t.Ma.addReference(i.key,e),Pd(t,i)):i instanceof md?(Fo("SyncEngine","Document no longer in limbo: "+i.key),t.Ma.removeReference(i.key,e),t.Ma.containsKey(i.key)||Md(t,i.key)):Bo()}function Pd(t,e){const n=e.key,i=n.path.canonicalString();t.va.get(n)||t.Ca.has(i)||(Fo("SyncEngine","New document in limbo: "+n),t.Ca.add(i),Fd(t))}function Fd(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){const e=t.Ca.values().next().value;t.Ca.delete(e);const n=new ha(ca.fromString(e)),i=t.Na.next();t.Fa.set(i,new wd(n)),t.va=t.va.insert(n,i),Nh(t.remoteStore,new Rl(Fc(Mc(n.path)),i,"TargetPurposeLimboResolution",ba.oe))}}async function Vd(t,e,n){const i=jo(t),r=[],s=[],o=[];i.ba.isEmpty()||(i.ba.forEach(((t,a)=>{o.push(i.Ba(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=th.Qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),i.Sa.l_(r),await async function(t,e){const n=jo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>va.forEach(e,(e=>va.forEach(e.ki,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>va.forEach(e.qi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!wa(t))throw t;Fo("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ts.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.ts=n.ts.insert(e,r)}}}(i.localStore,s))}async function qd(t,e){const n=jo(t);if(!n.currentUser.isEqual(e)){Fo("SyncEngine","User change. New user:",e.toKey());const t=await rh(n.localStore,e);n.currentUser=e,function(t,e){t.Oa.forEach((t=>{t.forEach((t=>{t.reject(new Ko($o.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Oa.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Vd(n,t._s)}}function Ud(t,e){const n=jo(t),i=n.Fa.get(e);if(i&&i.wa)return nu().add(i.key);{let t=nu();const i=n.Da.get(e);if(!i)return t;for(const e of i){const i=n.ba.get(e);t=t.unionWith(i.view.Ea)}return t}}function Bd(t){const e=jo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Cd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ud.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Dd.bind(null,e),e.Sa.l_=ud.bind(null,e.eventManager),e.Sa.ka=ld.bind(null,e.eventManager),e}function zd(t){const e=jo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kd.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Nd.bind(null,e),e}class jd{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=bh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new ih(t,e,n,i)}(this.persistence,new nh,t.initialUser,this.serializer)}createPersistence(t){return new Yl(Zl.jr,this.serializer)}createSharedClientState(t){return new lh}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class $d{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ad(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=qd.bind(null,this.syncEngine),await async function(t,e){const n=jo(t);e?(n.M_.delete(2),await Dh(n)):e||(n.M_.add(2),await kh(n),n.N_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new cd}createDatastore(t){const e=bh(t.databaseInfo.databaseId),n=function(t){return new vh(t)}(t.databaseInfo);return function(t,e,n,i){return new Sh(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,r){return new Ah(t,e,n,i,r)}(this.localStore,this.datastore,t.asyncQueue,(t=>Ad(this.syncEngine,t,0)),dh.D()?new dh:new hh)}createSyncEngine(t,e){return function(t,e,n,i,r,s,o){const a=new bd(t,e,n,i,r,s);return o&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=jo(t);Fo("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await kh(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class Kd{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):Vo("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Hd{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Lo.UNAUTHENTICATED,this.clientId=na.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Fo("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Fo("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ko($o.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ho;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=id(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Gd(t,e){t.asyncQueue.verifyOperationInProgress(),Fo("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await rh(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Qd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Fo("FirestoreClient","Using user provided OfflineComponentProvider");try{await Gd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===$o.FAILED_PRECONDITION||t.code===$o.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;qo("Error using user provided cache. Falling back to memory cache: "+n),await Gd(t,new jd)}}else Fo("FirestoreClient","Using default OfflineComponentProvider"),await Gd(t,new jd);return t._offlineComponents}(t);Fo("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Zh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Zh(e.remoteStore,n))),t._onlineComponents=e}async function Wd(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Fo("FirestoreClient","Using user provided OnlineComponentProvider"),await Qd(t,t._uninitializedComponentsProvider._online)):(Fo("FirestoreClient","Using default OnlineComponentProvider"),await Qd(t,new $d))),t._onlineComponents}async function Xd(t){const e=await Wd(t),n=e.eventManager;return n.onListen=Ed.bind(null,e.syncEngine),n.onUnlisten=Id.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Td.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Sd.bind(null,e.syncEngine),n}function Yd(t,e,n={}){const i=new Ho;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,r){const s=new Kd({next:s=>{e.enqueueAndForget((()=>async function(t,e){const n=jo(t),i=e.query;let r=3;const s=n.queries.get(i);if(s){const t=s.U_.indexOf(e);t>=0&&(s.U_.splice(t,1),0===s.U_.length?r=e.G_()?0:1:!s.W_()&&e.G_()&&(r=2))}switch(r){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}(t,o)));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new Ko($o.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new Ko($o.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:t=>r.reject(t)}),o=new pd(Mc(n.path),s,{includeMetadataChanges:!0,ra:!0});return async function(t,e){const n=jo(t);let i=3;const r=e.query;let s=n.queries.get(r);s?!s.W_()&&e.G_()&&(i=2):(s=new ad,i=e.G_()?0:1);try{switch(i){case 0:s.K_=await n.onListen(r,!0);break;case 1:s.K_=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(t){const n=id(t,`Initialization of query '${Bc(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.U_.push(e),e.j_(n.onlineState),s.K_&&e.H_(s.K_)&&hd(n)}(t,o)}(await Xd(t),t.asyncQueue,e,n,i))),i.promise}function Jd(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Zd=new Map;function tf(t){if(!ha.isDocumentKey(t))throw new Ko($o.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function ef(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Bo()}function nf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ko($o.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ef(t);throw new Ko($o.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class rf{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Ko($o.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ko($o.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new Ko($o.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jd(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ko($o.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ko($o.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ko($o.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class sf{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ko($o.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ko($o.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rf(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Qo;switch(t.type){case"firstParty":return new Jo(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ko($o.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Zd.get(t);e&&(Fo("ComponentProvider","Removing Datastore"),Zd.delete(t),e.terminate())}(this),Promise.resolve()}}class of{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new of(this.firestore,t,this._query)}}class af{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new af(this.firestore,t,this._key)}}class cf extends of{constructor(t,e,n){super(t,e,Mc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new af(this.firestore,null,new ha(t))}withConverter(t){return new cf(this.firestore,t,this._path)}}class uf{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Eh(this,"async_queue_retry"),this.hu=()=>{const t=wh();t&&Fo("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const t=wh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;const e=wh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise((()=>{}));const e=new Ho;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.su.push(t),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!wa(t))throw t;Fo("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko((()=>this.Tu()))}}Iu(t){const e=this.iu.then((()=>(this.uu=!0,t().catch((t=>{this.au=t,this.uu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Vo("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.uu=!1,t))))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);const i=nd.createAndSchedule(this,t,e,n,(t=>this.Eu(t)));return this._u.push(i),i}Pu(){this.au&&Bo()}verifyOperationInProgress(){}async du(){let t;do{t=this.iu,await t}while(t!==this.iu)}Au(t){for(const e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then((()=>{this._u.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._u)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.du()}))}Vu(t){this.lu.push(t)}Eu(t){const e=this._u.indexOf(t);this._u.splice(e,1)}}class lf extends sf{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new uf,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||df(this),this._firestoreClient.terminate()}}function hf(t){return t._firestoreClient||df(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function df(t){var e,n,i;const r=t._freezeSettings(),s=function(t,e,n,i){return new Ba(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Jd(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Hd(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class ff{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ff(La.fromBase64String(t))}catch(t){throw new Ko($o.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ff(La.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class pf{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ko($o.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new la(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class gf{constructor(t){this._methodName=t}}class mf{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ko($o.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ko($o.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ia(this._lat,t._lat)||ia(this._long,t._long)}}const yf=/^__.*__$/;class vf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ku(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function wf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Bo()}}class bf{constructor(t,e,n,i,r,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.mu(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new bf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.wu(t),i}Su(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return kf(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(0===t.length)throw this.Du("Document fields must not be empty");if(wf(this.fu)&&yf.test(t))throw this.Du('Document fields cannot begin and end with "__"')}}class Ef{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||bh(t)}Fu(t,e,n,i=!1){return new bf({fu:t,methodName:e,vu:n,path:la.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}class Tf extends gf{_toFieldTransform(t){if(2!==t.fu)throw 1===t.fu?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Tf}}function _f(t,e){if(If(t=b(t)))return Sf("Unsupported field value:",e,t),function(t,e){const n={};return Sa(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ia(t,((t,i)=>{const r=_f(i,e.pu(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}(t,e);if(t instanceof gf)return function(t,e){if(!wf(e.fu))throw e.Du(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Du(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const r of t){let t=_f(r,e.bu(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ou(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=sa.fromDate(t);return{timestampValue:al(e.serializer,n)}}if(t instanceof sa){const n=new sa(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:al(e.serializer,n)}}if(t instanceof mf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ff)return{bytesValue:cl(e.serializer,t._byteString)};if(t instanceof af){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Du(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hl(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Du(`Unsupported field value: ${ef(t)}`)}(t,e)}function If(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof sa||t instanceof mf||t instanceof ff||t instanceof af||t instanceof gf)}function Sf(t,e,n){if(!If(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=ef(n);throw"an object"===i?e.Du(t+" a custom object"):e.Du(t+" "+i)}}function Cf(t,e,n){if((e=b(e))instanceof pf)return e._internalPath;if("string"==typeof e)return Df(t,e);throw kf("Field path arguments must be of type string or ",t,!1,void 0,n)}const Af=new RegExp("[~\\*/\\[\\]]");function Df(t,e,n){if(e.search(Af)>=0)throw kf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new pf(...e.split("."))._internalPath}catch(i){throw kf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function kf(t,e,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new Ko($o.INVALID_ARGUMENT,a+t+c)}function Nf(t,e){return t.some((t=>t.isEqual(e)))}class xf{constructor(t,e,n,i,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new af(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Rf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Lf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Rf extends xf{data(){return super.data()}}function Lf(t,e){return"string"==typeof e?Df(t,e):e instanceof pf?e._internalPath:e._delegate._internalPath}class Mf{convertValue(t,e="none"){switch($a(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pa(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Fa(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Bo()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ia(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new mf(Pa(t.latitude),Pa(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=qa(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ua(t));default:return null}}convertTimestamp(t){const e=Oa(t);return new sa(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ca.fromString(t);zo(xl(n));const i=new za(n.get(1),n.get(3)),r=new ha(n.popFirst(5));return i.isEqual(e)||Vo(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class Of{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pf extends xf{constructor(t,e,n,i,r,s){super(t,e,n,i,s),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ff(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Lf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ff extends Pf{data(t={}){return super.data(t)}}class Vf extends Mf{constructor(t){super(),this.firestore=t}convertBytes(t){return new ff(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new af(this.firestore,null,e)}}function qf(t,e){return function(t,e){const n=new Ho;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=zd(t);try{const t=await function(t,e){const n=jo(t),i=sa.now(),r=e.reduce(((t,e)=>t.add(e.key)),nu());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Gc(),c=nu();return n.ss.getEntries(t,r).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((r=>{s=r;const o=[];for(const t of e){const e=Cu(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new ku(t.key,e,sc(e.value.mapValue),bu.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:Xc(s)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.xa[t.currentUser.toKey()];i||(i=new Ca(ia)),i=i.insert(e,n),t.xa[t.currentUser.toKey()]=i}(i,t.batchId,n),await Vd(i,t.changes),await $h(i.remoteStore)}catch(t){const e=id(t,"Failed to persist write");n.reject(e)}}(await function(t){return Wd(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(hf(t),e)}new WeakMap,function(t,e=!0){Mo="10.11.1",Nt(new E("firestore",((t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),s=new lf(new Xo(t.getProvider("auth-internal")),new ta(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ko($o.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new za(t.options.projectId,e)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),Pt(Ro,"4.6.1",t),Pt(Ro,"4.6.1","esm2017")}();const Uf=Mt({apiKey:"AIzaSyBsZDKyla0iRBlPvzAH7nnM2g4yZ0Z32qg",authDomain:"calculus-grade-calculato-f5e00.firebaseapp.com",projectId:"calculus-grade-calculato-f5e00",storageBucket:"calculus-grade-calculato-f5e00.appspot.com",messagingSenderId:"300676061",appId:"1:300676061:web:a4d73fd75da03b1b873c34",measurementId:"G-34HY7HMRHN"}),Bf=(function(t=Ot()){const e=xt(t=b(t),Oe);e.isInitialized()?e.getImmediate():function(t,e={}){const n=xt(t,Oe);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw ze.create("already-initialized")}n.initialize({options:e})}(t)}(Uf),function(t,e){const n="string"==typeof t?t:"(default)",i=xt("object"==typeof t?t:Ot(),"firestore").getImmediate({identifier:n});if(!i._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("firestore");t&&function(t,e,n,i={}){var s;const o=(t=nf(t,sf))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&qo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Lo.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new Ko($o.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Lo(o)}t._authCredentials=new Wo(new Go(e,n))}}(i,...t)}return i}(Uf)),zf=document.cookie.split("id=")[1]?.split(";")[0],jf=document.querySelector(".buttons"),$f={attendance:document.querySelector("#attendance"),homework:document.querySelector("#homework"),midterm1:document.querySelector("#midterm1"),midterm2:document.querySelector("#midterm2"),finalExam:document.querySelector("#finalExam"),extraCredit:document.querySelector("#extraCredit"),quiz1:document.querySelector("#quiz1"),quiz2:document.querySelector("#quiz2"),quiz3:document.querySelector("#quiz3"),quiz4:document.querySelector("#quiz4"),quiz5:document.querySelector("#quiz5"),quiz6:document.querySelector("#quiz6"),quiz7:document.querySelector("#quiz7"),quiz8:document.querySelector("#quiz8"),quiz9:document.querySelector("#quiz9"),quiz10:document.querySelector("#quiz10"),quiz11:document.querySelector("#quiz11")};function Kf(){let t=0,e=10;for(let n=1;n<=11;n++){const i=Number($f[`quiz${n}`].value);t+=i,i<e&&(e=i)}t-=e;let n=.05*Number($f.attendance.value)+.1*Number($f.homework.value)+.2*Number(t)+Number($f.extraCredit.value),i=n;const r=Number($f.midterm1.value),s=Number($f.midterm2.value),o=Number($f.finalExam.value);n+=.2*r+.2*s+.25*o,i+=.15*Math.min(r,s)+.2*Math.max(r,s)+.3*o,document.querySelector("#option1").innerText=n.toString().slice(0,5),document.querySelector("#option2").innerText=i.toString().slice(0,5),document.querySelectorAll(".grade").forEach((t=>{t.classList.remove("final-grade")}));const a=Math.max(n,i);a>=94?document.querySelector("#a").classList.add("final-grade"):a>=90?document.querySelector("#a-minus").classList.add("final-grade"):a>=87?document.querySelector("#b-plus").classList.add("final-grade"):a>=83?document.querySelector("#b").classList.add("final-grade"):a>=80?document.querySelector("#b-minus").classList.add("final-grade"):a>=77?document.querySelector("#c-plus").classList.add("final-grade"):a>=73?document.querySelector("#c").classList.add("final-grade"):a>=70&&document.querySelector("#c-minus").classList.add("final-grade")}if(void 0===zf)jf.innerHTML+='\n    <a href="https://calculus-grade-calculator.pages.dev/login">\n      <div class="button">Login</div>\n    </a>\n  ';else{jf.innerHTML+='\n    <div id="logout" class="button">Logout</div>\n    <div id="save" class="button">Save</div>\n    <div id="load" class="button">Load</div>\n  ',document.querySelector("#logout").addEventListener("click",(()=>{document.cookie="id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",window.location.href="https://calculus-grade-calculator.pages.dev"}));const t=function(t,e,...n){if(t=b(t),1===arguments.length&&(e=na.newId()),function(t,e,n){if(!n)throw new Ko($o.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof sf){const i=ca.fromString(e,...n);return tf(i),new af(t,null,new ha(i))}{if(!(t instanceof af||t instanceof cf))throw new Ko($o.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ca.fromString(e,...n));return tf(i),new af(t.firestore,t instanceof cf?t.converter:null,new ha(i))}}(Bf,"users",zf);document.querySelector("#save").addEventListener("click",(async()=>{await function(t,e,n,...i){t=nf(t,af);const r=nf(t.firestore,lf),s=function(t){const e=t._freezeSettings(),n=bh(t._databaseId);return new Ef(t._databaseId,!!e.ignoreUndefinedProperties,n)}(r);let o;return o="string"==typeof(e=b(e))||e instanceof pf?function(t,e,n,i,r,s){const o=t.Fu(1,e,n),a=[Cf(e,i,n)],c=[r];if(s.length%2!=0)throw new Ko($o.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(Cf(e,s[t])),c.push(s[t+1]);const u=[],l=rc.empty();for(let t=a.length-1;t>=0;--t)if(!Nf(u,a[t])){const e=a[t];let n=c[t];n=b(n);const i=o.Su(e);if(n instanceof Tf)u.push(e);else{const t=_f(n,i);null!=t&&(u.push(e),l.set(e,t))}}const h=new xa(u);return new vf(l,h,o.fieldTransforms)}(s,"updateDoc",t._key,e,n,i):function(t,e,n,i){const r=t.Fu(1,e,n);Sf("Data must be an object, but it was:",r,i);const s=[],o=rc.empty();Ia(i,((t,i)=>{const a=Df(e,t,n);i=b(i);const c=r.Su(a);if(i instanceof Tf)s.push(a);else{const t=_f(i,c);null!=t&&(s.push(a),o.set(a,t))}}));const a=new xa(s);return new vf(o,a,r.fieldTransforms)}(s,"updateDoc",t._key,e),qf(r,[o.toMutation(t._key,bu.exists(!0))])}(t,{scores:{attendance:$f.attendance.value,homework:$f.homework.value,midterm1:$f.midterm1.value,midterm2:$f.midterm2.value,finalExam:$f.finalExam.value,extraCredit:$f.extraCredit.value,quiz1:$f.quiz1.value,quiz2:$f.quiz2.value,quiz3:$f.quiz3.value,quiz4:$f.quiz4.value,quiz5:$f.quiz5.value,quiz6:$f.quiz6.value,quiz7:$f.quiz7.value,quiz8:$f.quiz8.value,quiz9:$f.quiz9.value,quiz10:$f.quiz10.value,quiz11:$f.quiz11.value}}),alert("Saved")})),document.querySelector("#load").addEventListener("click",(async()=>{const e=(await function(t){t=nf(t,af);const e=nf(t.firestore,lf);return Yd(hf(e),t._key).then((n=>function(t,e,n){const i=n.docs.get(e._key),r=new Vf(t);return new Pf(t,r,e._key,i,new Of(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}(t)).data().scores;$f.attendance.value=e.attendance,$f.homework.value=e.homework,$f.midterm1.value=e.midterm1,$f.midterm2.value=e.midterm2,$f.finalExam.value=e.finalExam,$f.extraCredit.value=e.extraCredit,$f.quiz1.value=e.quiz1,$f.quiz2.value=e.quiz2,$f.quiz3.value=e.quiz3,$f.quiz4.value=e.quiz4,$f.quiz5.value=e.quiz5,$f.quiz6.value=e.quiz6,$f.quiz7.value=e.quiz7,$f.quiz8.value=e.quiz8,$f.quiz9.value=e.quiz9,$f.quiz10.value=e.quiz10,$f.quiz11.value=e.quiz11,Kf()}))}document.querySelectorAll("input").forEach((t=>{t.addEventListener("input",(()=>{Kf()}))})),document.querySelector("#reset").addEventListener("click",(()=>{["attendance","homework","midterm1","midterm2","finalExam"].forEach((t=>{$f[t].value=100})),$f.extraCredit.value=0;for(let t=1;t<=11;t++)$f[`quiz${t}`].value=10;Kf()})),Kf()})();